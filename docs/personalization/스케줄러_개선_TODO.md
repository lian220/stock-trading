# 📋 스케줄러 개선 TODO 리스트

## ✅ 완료된 개선사항

### 1. 스케줄러 구조 및 순서 최적화
- [x] `fetch_and_store_sentiment_for_recommendations()` → `fetch_and_store_sentiment_independent()`로 수정 (AI 의존성 제거)
- [x] 병렬 분석 도입: 기술적 지표와 감정 분석을 동시 실행 (23:05)
- [x] 통합 분석 분리: `_run_combined_analysis()`에서 최종 추천 생성 (23:45)
- [x] Vertex AI 예측(23:00)과 분석 작업 분리
- [x] 경제 데이터 업데이트와 Vertex AI 예측 병렬 실행 (`_run_23_00_tasks`) 구현

### 2. 공매도 분석 통합
- [x] 공매도 데이터 수집 (daily_stock_data) 및 분석 로직 통합
- [x] 숏 스퀴즈 포착 로직 (공매도 비율 10%↑ + 골든크로스 = 가산점)
- [x] 공매도 과열 종목 위험 회피 (공매도 비율 15%↑ + 하락세 = 감점)

### 3. 매수/매도 로직 개선
- [x] 매수 시간 조정: 00:00(장 시작 30분 후) → 23:50(장 시작 20분 후) 변경 완료
- [x] 포트폴리오 비중 관리: 단일 종목 최대 투자 비중(예: 20%) 제한 로직 `_execute_auto_buy`에 추가 (2025-12-22 완료)
- [x] 익절/손절 우선 처리: 매도 로직에서 익절/손절 조건을 기술적 매도보다 먼저 확실하게 처리하도록 로직 명시화 (2025-12-22 완료) - 자세한 내용은 `docs/trading/자동매도_전략_가이드.md` 참조
- [x] 레버리지 티커 지원: 본주 가격으로 조건 확인, 레버리지 티커로 주문 실행 로직 구현
- [x] 매도 스케줄러 주기 1분 → 5분으로 변경 (API 부하 감소)
- [x] 중복 매수 방지 로직 활성화
- [x] 주문 실패 추적 및 일시적 제외 로직 (ORDER_FAILURE_EXCLUDE_MINUTES)
- [x] 현재가 조회 실패 추적 및 일시적 제외 로직 (MAX_PRICE_FETCH_FAILURES, PRICE_FETCH_EXCLUDE_MINUTES)

### 4. 체결 확인 및 상태 관리
- [x] 주문 체결 여부 확인 로직 (`_check_and_update_execution`)
- [x] 주문 체결 내역 조회 (TTTS3018R API)
- [x] 잔고 조회를 통한 Fallback 체결 확인
- [x] 체결 상태 자동 업데이트 (accepted → executed/pending)
- [x] 트레일링 스톱 자동 초기화 (매수 체결 시)

### 5. 트레일링 스톱 구현
- [x] 트레일링 스톱(Trailing Stop): 고정 익절 대신 주가 상승에 따라 익절가를 높이는 로직 구현 (2026-01-08 완료)
- [x] 트레일링 스톱 최고가 갱신 (`_execute_auto_sell`에서 매도 조건 체크 전 실행)
- [x] 레버리지 종목별 트레일링 스톱 거리 차별화

### 6. 미체결 주문 처리
- [x] 장 마감 후 미체결 주문 정리 (`_cleanup_pending_orders`)
- [x] 어제 주문한 주문 체결 확인 및 재주문 로직
- [x] 재주문 시도 횟수 제한 (최대 1회)

### 7. 포트폴리오 수익률 리포트
- [x] 실시간 수익률 및 자산 알림: 매매 체결 직후 총 자산 및 실현 수익률을 즉시 계산하여 Slack 알림에 포함 (2026-01-08 완료)
- [x] 포트폴리오 수익률 리포트 스케줄러 (매일 07:00)
- [x] 종목별 실현 수익률 계산 (`update_ticker_realized_profit`)
- [x] 전체 포트폴리오 수익률 계산 (`calculate_total_return`)
- [x] 누적 실현 수익률 계산 (`calculate_cumulative_profit`)

### 8. 에러 처리 및 안정성
- [x] 중복 실행 방지 플래그 (`buy_executing`, `analysis_executing`, `prediction_executing`, `economic_executing`, `tasks_23_00_executing`)
- [x] API 속도 제한 대응 (PRICE_FETCH_RATE_LIMIT_SLEEP_SECONDS)
- [x] 장외거래시간 에러 처리 (APBK0918)
- [x] 주문 간 지연 (ORDER_DELAY_SECONDS)
- [x] 체결 확인 타임아웃 (EXECUTION_CHECK_TIMEOUT_SECONDS)

---

## 🚀 예정된 개선사항 (TODO)

### 우선순위 0: 개인화 및 멀티 유저 지원 (기반 작업)

#### 멀티 유저 자동매수 지원
- [x] **멀티 유저 자동매수 지원** (2026-01-09 완료)
  - [x] `AutoTradingService.get_active_users()` 메서드 구현 - trading_config.enabled=true인 모든 사용자 조회
  - [x] `get_buy_candidates()`에서 하드코딩된 user_id 제거하고 파라미터로 받은 user_id 사용
  - [x] `scheduler.py`의 `_execute_auto_buy()`를 수정하여 모든 활성 사용자에 대해 매수 실행
  - [x] 사용자별 설정, 레버리지 설정, 매수 후보 필터링 적용
  - [x] 사용자별 매수 실행 및 결과 집계
  - [x] `_save_trading_log()`에 user_id 파라미터 추가

#### 사용자 컨텍스트 관리
- [x] **사용자 컨텍스트 유틸리티 구현** (이미 구현됨)
  - [x] `app/utils/user_context.py` 생성 (이미 존재)
  - [x] 현재 사용자 ID 가져오기 함수 구현 (`get_current_user_id()`, 환경변수 또는 설정에서)
  - [x] 사용자 컨텍스트 관리 클래스 구현 (`UserContext` 클래스)
  - [x] 기본 사용자 ID 설정 (환경변수 `DEFAULT_USER_ID` 또는 기본값 'lian')
- [x] **하드코딩된 user_id 제거** (2026-01-09 완료)
  - [x] `TrailingStopService`의 user_id 하드코딩 제거 (이미 `get_current_user_id()` 사용 중)
  - [x] `StockRecommendationService`의 user_id 하드코딩 제거 (`get_stock_recommendations()`에 `user_id` 파라미터 추가)
  - [x] `scheduler.py`의 user_id 하드코딩 제거 (자동매수 부분 완료, 2026-01-09)
  - [x] `balance_service.py`의 기본 user_id 파라미터 처리 개선 (`get_access_token`, `refresh_token_with_retry`, `calculate_total_return` 수정)
  - [x] `app/api/routes/balance.py`의 기본 user_id 파라미터 처리 개선
  - [x] `app/models/mongodb_models.py`의 `TrailingStop` 모델 기본값 제거
- [x] **스케줄러 사용자 설정** (자동매수 완료)
  - [x] 스케줄러 실행 시 활성 사용자 자동 감지 (`trading_config.enabled = true`)
  - [x] 스케줄러가 여러 사용자를 지원하도록 구조 변경 (자동매수 완료, 2026-01-09)
- [ ] **API 사용자 인증/인가**
  - [ ] API 요청에서 user_id 추출 로직 (쿼리 파라미터, 헤더, 또는 JWT)
  - [ ] 사용자 인증 미들웨어 구현 (선택사항, 향후 확장)
  - [ ] 사용자별 데이터 접근 권한 검증

### 우선순위 1: 단기 개선 (안정성 & 수익성)

#### 리스크 관리 강화
- [ ] **일일 최대 손실 제한**
  - [ ] 일일 손실 추적을 위한 MongoDB 컬렉션/필드 설계 (`daily_loss_tracking`)
  - [ ] 일일 손실 계산 로직 구현 (매도 시 손실 누적)
  - [ ] 설정 가능한 일일 최대 손실 금액 (기본값: $1000) 추가
  - [ ] 일일 손실이 임계값 초과 시 매수 스케줄러 자동 중단 로직
  - [ ] 일일 손실 리셋 로직 (자정 또는 장 시작 시)
  - [ ] 일일 손실 알림 기능 (Slack)

- [ ] **최대 보유 종목 수 제한**
  - [ ] 설정 가능한 최대 보유 종목 수 (기본값: 20개) 추가
  - [ ] 보유 종목 수 체크 로직 (`get_buy_candidates` 또는 `execute_auto_buy`에 추가)
  - [ ] 최대 보유 종목 수 도달 시 매수 스킵 로직
  - [ ] 보유 종목 수 추적 및 로깅

- [ ] **섹터 분산 규칙**
  - [ ] 종목별 섹터 정보 수집 (MongoDB `stocks` 컬렉션에 `sector` 필드 추가)
  - [ ] 섹터별 보유 비중 계산 로직
  - [ ] 설정 가능한 섹터별 최대 비중 (기본값: 30%) 추가
  - [ ] 섹터별 최대 비중 초과 시 매수 제외 로직
  - [ ] 섹터 분산 위반 알림 기능

- [ ] **상관관계 관리**
  - [ ] 종목 간 상관계수 계산 로직 구현 (과거 가격 데이터 기반)
  - [ ] 상관계수 임계값 설정 (기본값: 0.7) 추가
  - [ ] 높은 상관관계 종목 그룹 탐지 로직
  - [ ] 상관관계가 높은 종목 간 과도한 집중 방지 로직
  - [ ] 상관관계 데이터 캐싱 및 업데이트 주기 결정

#### 시장 상황 모니터링
- [ ] **VIX 기반 시장 감지**
  - [ ] VIX 지수 데이터 수집 API 연동 (yfinance 또는 FRED)
  - [ ] VIX 지수 MongoDB 저장 로직 (일별/실시간)
  - [ ] VIX 지수 기반 시장 상황 분류 로직 구현
    - VIX > 30: 높은 변동성 (매수 완전 금지)
    - VIX 20-30: 중간 변동성 (매수 비중 50% 축소, 최소 종합 점수 상향)
    - VIX < 15: 낮은 변동성 (정상 운영, 최대 포지션 수 증가)
  - [ ] 시장 상황에 따른 매수 로직 조정 (`execute_auto_buy`에 적용)
  - [ ] 시장 상황별 최소 종합 점수 동적 조정
  - [ ] 시장 상황별 최대 포지션 수 동적 조정
  - [ ] 시장 상황 변화 알림 기능 (Slack)

- [ ] **나스닥 지수 변동성 모니터링**
  - [ ] 나스닥 지수 일일 변동폭 계산 로직
  - [ ] 일일 변동폭 임계값 설정 (기본값: ±3%)
  - [ ] 변동폭 초과 시 매수 신중화 로직 (최소 종합 점수 상향)
  - [ ] 나스닥 지수 데이터 수집 및 저장

- [ ] **시장 상황에 따른 손절/익절 비율 동적 조정**
  - [ ] 변동성 지표 기반 손절/익절 비율 계산 로직
  - [ ] 높은 변동성 시 손절 비율 타이트하게 조정 (예: -7% → -5%)
  - [ ] 높은 변동성 시 익절 비율 조정 (예: +5% → +3%)
  - [ ] 변동성별 손절/익절 비율 설정 테이블 설계
  - [ ] 동적 조정 로직을 `get_stocks_to_sell`에 통합

#### 매도 전략 고도화
- [x] **부분 익절 전략 (피라미드 매도)**: 고정 익절 대신 단계별 부분 매도
  - 일반 종목:
    - 1차: +5% 도달 시 30% 매도
    - 2차: +8% 도달 시 30% 매도
    - 3차: +12% 도달 시 40% 매도
  - 레버리지 종목 (2배 기준):
    - 1차: +10% 도달 시 30% 매도
    - 2차: +16% 도달 시 30% 매도
    - 3차: +24% 도달 시 40% 매도
  - 트레일링 스톱으로 나머지 관리 (2026-01-08 완료)

- [ ] **시간 기반 익절**
  - [ ] 매수 체결 시 보유 시작일 추적 (MongoDB `trading_logs` 또는 별도 컬렉션)
  - [ ] 보유 기간 계산 로직 구현
  - [ ] 보유 기간별 익절 비율 테이블 설계
    - 1일 미만: 기본 익절 비율 (+5%)
    - 1주일 이상: 익절 비율 상향 (+6%)
    - 2주일 이상: 익절 비율 추가 상향 (+7%)
    - 1개월 이상: 익절 비율 더 상향 (+8%)
  - [ ] 시간 기반 익절 로직을 `get_stocks_to_sell`에 통합
  - [ ] 보유 기간 추적 및 로깅

### 우선순위 2: 중기 개선 (고도화)

#### 거래 시간 관리 강화
- [ ] **장 시작/종료 시간 정확도 향상**
  - [ ] 서머타임(DST) 자동 감지 로직 구현
  - [ ] pytz를 이용한 정확한 뉴욕 시간대 계산
  - [ ] 장 시작/종료 시간 계산 유틸리티 함수 생성
  - [ ] 현재 스케줄러의 시간 체크 로직 리팩토링
  - [ ] 서머타임 전환 시 테스트 및 검증

- [ ] **프리마켓/애프터마켓 거래 시간 고려**
  - [ ] 프리마켓 시간대 정의 (04:00-09:30 ET)
  - [ ] 애프터마켓 시간대 정의 (16:00-20:00 ET)
  - [ ] 확장 거래 시간 설정 옵션 추가 (기본값: false)
  - [ ] 확장 거래 시간 활성화 시 거래 허용 로직
  - [ ] 확장 거래 시간 시 주의사항 문서화 (유동성, 스프레드 등)

- [ ] **공휴일 자동 감지**
  - [ ] 미국 공휴일 데이터 소스 선정 (API 또는 정적 데이터)
  - [ ] 공휴일 데이터 수집 및 저장 로직
  - [ ] 공휴일 체크 유틸리티 함수 구현
  - [ ] 공휴일 감지 시 거래 중단 로직 (`_execute_auto_buy`, `_execute_auto_sell`)
  - [ ] 공휴일 알림 기능 (Slack)

#### 에러 복구 및 재시도 로직
- [ ] **스케줄러 실행 실패 시 자동 재시도**
  - [ ] 백오프 전략 설계 (Exponential Backoff 또는 Linear Backoff)
  - [ ] 재시도 횟수 설정 (기본값: 3회)
  - [ ] 재시도 간격 설정 (초기: 5초, 최대: 60초)
  - [ ] 스케줄러 함수 래퍼(데코레이터) 구현
  - [ ] 재시도 실패 시 알림 기능 (Slack)
  - [ ] 재시도 이력 로깅 (MongoDB)

- [ ] **API 연결 끊김 자동 복구**
  - [ ] API 연결 상태 모니터링 로직
  - [ ] 연결 끊김 감지 메커니즘 (타임아웃, 에러 코드 체크)
  - [ ] 자동 재연결 시도 로직 (지수 백오프)
  - [ ] 재연결 성공/실패 알림
  - [ ] 연결 풀 관리 개선 (httpx, requests 세션)

- [ ] **주문 체결 확인 재시도 강화**
  - [ ] 체결 확인 재시도 횟수 증가 (현재: 1회 → 3-5회)
  - [ ] 재시도 간격 설정 (초기: 5초, 점진적 증가)
  - [ ] 체결 확인 실패 원인 분석 및 분류
  - [ ] 재시도 로직을 `_check_and_update_execution`에 통합
  - [ ] 최종 실패 시 수동 확인 알림

#### 주문 관리 고도화
- [ ] **주문 취소 로직**
  - [ ] 한국투자증권 API 주문 취소 기능 조사 (API 문서 확인)
  - [ ] 주문 취소 API 연동 (`balance_service.py`)
  - [ ] 미체결 주문 조회 및 필터링 로직
  - [ ] 수동 주문 취소 API 엔드포인트 추가 (`api/routes/auto_trading.py`)
  - [ ] 자동 주문 취소 조건 정의 (예: 장 마감 전 미체결 주문)
  - [ ] 주문 취소 스케줄러 구현 (`_auto_cancel_pending_orders`)
  - [ ] 주문 취소 이력 로깅

- [ ] **주문 수정 로직**
  - [ ] 한국투자증권 API 주문 수정 기능 조사 (API 문서 확인)
  - [ ] 주문 수정 API 연동 (`balance_service.py`)
  - [ ] 주문 수정 요청 스키마 설계 (가격, 수량)
  - [ ] 수동 주문 수정 API 엔드포인트 추가
  - [ ] 주문 수정 이력 로깅

- [ ] **주문 유효기간 설정**
  - [ ] 주문 유효기간 필드 추가 (MongoDB `trading_logs`)
  - [ ] 주문 생성 시 유효기간 설정 로직
  - [ ] 유효기간 만료 주문 자동 취소 로직
  - [ ] 유효기간 체크 스케줄러 구현
  - [ ] 유효기간 만료 알림 기능

#### 성과 추적 및 분석
- [ ] **성과 추적 대시보드 데이터 구조 설계**
  - [ ] 대시보드용 데이터 집계 컬렉션 설계 (`performance_dashboard`)
  - [ ] 일별 수익률 데이터 구조 정의
  - [ ] 추천 정확도 메트릭 정의 (정확도, 정밀도, 재현율)
  - [ ] 데이터 집계 스케줄러 구현 (매일 자정)
  - [ ] 대시보드 API 엔드포인트 설계 (`api/routes/performance.py`)

- [ ] **매매 전략별 성과 분석**
  - [ ] 전략별 태그 시스템 설계 (AI 예측, 기술적 지표, 감정 분석)
  - [ ] 전략별 매매 이력 추적 (`trading_logs`에 `strategy_tags` 필드 추가)
  - [ ] 전략별 승률 계산 로직
  - [ ] 전략별 평균 수익률 계산 로직
  - [ ] 전략별 성과 비교 리포트 생성

- [ ] **종목별 성과 통계**
  - [ ] 종목별 성과 통계 컬렉션 설계 (`ticker_performance_stats`)
  - [ ] 종목별 평균 보유 기간 계산 로직
  - [ ] 종목별 평균 수익률 계산 로직
  - [ ] 종목별 승률 계산 로직 (수익 거래 / 전체 거래)
  - [ ] 종목별 성과 통계 업데이트 스케줄러 (주간)
  - [ ] 종목별 성과 조회 API 엔드포인트

- [ ] **리스크 지표 계산**
  - [ ] 최대 낙폭(MDD) 계산 로직 구현
  - [ ] 샤프 비율 계산 로직 구현 (무위험 수익률 가정 필요)
  - [ ] 소르티노 비율 계산 로직 구현
  - [ ] 리스크 지표 집계 및 저장 (`portfolio_risk_metrics`)
  - [ ] 리스크 지표 조회 API 엔드포인트

### 우선순위 3: 장기 개선 (시스템)

#### 아키텍처 개선
- [ ] **서비스 클래스 리팩토링**
  - [ ] **매수 로직 이관**
    - [ ] `scheduler.py`의 `_execute_auto_buy` 로직 분석 및 분리
    - [ ] `AutoTradingService.execute_auto_buy` 메서드 보완
    - [ ] 스케줄러는 `AutoTradingService` 호출만 하도록 변경
    - [ ] 매수 관련 설정 및 상태 관리를 서비스로 이관
  - [ ] **매도 로직 이관**
    - [ ] `scheduler.py`의 `_execute_auto_sell` 로직 분석 및 분리
    - [ ] `AutoTradingService.execute_auto_sell` 메서드 보완
    - [ ] 스케줄러는 `AutoTradingService` 호출만 하도록 변경
    - [ ] 매도 관련 설정 및 상태 관리를 서비스로 이관
  - [ ] **체결 확인 로직 이관**
    - [ ] `scheduler.py`의 `_check_and_update_execution` 로직 분석
    - [ ] `OrderExecutionService` 클래스 생성 또는 `BalanceService` 확장
    - [ ] 체결 확인 로직을 새 서비스로 이관
    - [ ] 스케줄러는 서비스 호출만 하도록 변경
  - [ ] **포트폴리오 리포트 이관**
    - [ ] 포트폴리오 리포트 관련 로직 식별
    - [ ] `PortfolioService` 클래스 생성
    - [ ] 리포트 생성 로직 이관
    - [ ] 리포트 스케줄러를 `PortfolioService` 호출로 변경
  - [ ] **리팩토링 후 테스트**
    - [ ] 각 서비스 단위 테스트 작성
    - [ ] 통합 테스트로 전체 흐름 검증
    - [ ] 성능 테스트 (리팩토링 전후 비교)

#### 알림 및 리포트 고도화
- [ ] **알림 고도화**
  - [ ] 차트 생성 라이브러리 선정 및 통합 (matplotlib, plotly 등)
  - [ ] 주가 차트 이미지 생성 기능 (`charts_service.py` 또는 유틸리티)
  - [ ] 기술적 지표 차트 생성 (RSI, MACD 등)
  - [ ] 분석 리포트 이미지 생성 (종합 점수, 감정 분석 등)
  - [ ] 이미지 업로드 기능 (GCS 또는 S3)
  - [ ] Slack 이미지 첨부 기능 추가 (`slack_notifier.py`)
  - [ ] 알림 템플릿 개선 (Markdown 포맷, 이미지 포함)

- [ ] **일일 리포트 자동 생성**
  - [ ] 리포트 생성 라이브러리 선정 (reportlab, weasyprint 등)
  - [ ] 리포트 템플릿 디자인
  - [ ] 일일 포트폴리오 요약 데이터 수집
  - [ ] PDF 생성 로직 구현 (`report_service.py`)
  - [ ] 리포트 스케줄러 구현 (매일 장 마감 후)
  - [ ] 리포트 파일 저장 및 관리 (GCS 또는 로컬)
  - [ ] 리포트 자동 전송 (Slack, 이메일 등)

- [ ] **주간/월간 리포트**
  - [ ] 주간 성과 데이터 집계 로직
  - [ ] 월간 성과 데이터 집계 로직
  - [ ] 주간/월간 리포트 템플릿 디자인
  - [ ] 리포트 생성 스케줄러 구현 (매주/매월 자동)
  - [ ] 리포트 자동 전송 (Slack, 이메일 등)

#### 백테스팅 및 전략 최적화
- [ ] **백테스팅 기능**
  - [ ] 과거 주가 데이터 수집 및 저장 (historical_data 컬렉션)
  - [ ] 백테스팅 시뮬레이션 엔진 설계
  - [ ] 백테스팅 파라미터 정의 (시작일, 종료일, 초기 자본 등)
  - [ ] `run_backtest` 함수 구현 (`backtest_service.py`)
  - [ ] 백테스팅 결과 저장 및 분석
  - [ ] 백테스팅 API 엔드포인트 추가
  - [ ] 백테스팅 결과 시각화 (차트, 테이블)

- [ ] **파라미터 자동 최적화**
  - [ ] 최적화할 파라미터 정의 (손절/익절 비율, 부분 매도 비율 등)
  - [ ] 최적화 알고리즘 선정 (Grid Search, Bayesian Optimization 등)
  - [ ] 최적화 목표 함수 정의 (수익률, 샤프 비율, MDD 등)
  - [ ] 파라미터 최적화 로직 구현
  - [ ] 최적화 결과 검증 및 적용
  - [ ] 최적화 이력 추적

- [ ] **전략 A/B 테스트**
  - [ ] 전략 버전 관리 시스템 설계
  - [ ] 다중 전략 동시 운영 로직
  - [ ] 전략별 포트폴리오 분리 또는 태그 시스템
  - [ ] 전략별 성과 추적 및 비교
  - [ ] A/B 테스트 결과 분석 및 시각화
  - [ ] 승리 전략 자동 선택 또는 가중치 조정

#### 데이터 수집 및 분석 확장
- [ ] **옵션 시장 데이터 활용**
  - [ ] 옵션 데이터 소스 선정 및 API 연동 (yfinance, options chain API)
  - [ ] Put/Call Ratio 계산 로직 구현
  - [ ] Implied Volatility (IV) 데이터 수집
  - [ ] 옵션 시장 지표 저장 구조 설계 (`options_data` 컬렉션)
  - [ ] 옵션 지표 기반 매매 신호 생성 로직
  - [ ] 옵션 지표를 추천 점수에 반영

- [ ] **소셜 미디어 감정 분석**
  - [ ] 소셜 미디어 데이터 소스 선정 (Reddit API, Twitter API 등)
  - [ ] 종목별 소셜 미디어 데이터 수집 로직
  - [ ] 소셜 미디어 감정 분석 모델 선정/개발 (기존 감정 분석 확장)
  - [ ] 소셜 미디어 감정 점수 저장 (`social_sentiment` 컬렉션)
  - [ ] 소셜 미디어 감정을 추천 점수에 반영
  - [ ] 소셜 미디어 트렌드 감지 로직 (급등/급락 키워드)

- [ ] **내부자 거래 데이터**
  - [ ] 내부자 거래 데이터 소스 선정 (SEC EDGAR API 또는 서비스)
  - [ ] 내부자 거래 데이터 수집 및 파싱 로직
  - [ ] 내부자 거래 데이터 저장 구조 설계 (`insider_trading` 컬렉션)
  - [ ] 내부자 매수/매도 신호 생성 로직
  - [ ] 내부자 거래를 추천 점수에 반영
  - [ ] 내부자 거래 알림 기능 (중요 거래 발생 시)

- [ ] **애널리스트 리포트 분석**
  - [ ] 애널리스트 리포트 데이터 소스 선정 (Bloomberg, Reuters, 또는 웹 스크래핑)
  - [ ] 애널리스트 등급 및 목표가 파싱 로직
  - [ ] 애널리스트 리포트 데이터 저장 구조 설계 (`analyst_reports` 컬렉션)
  - [ ] 목표가 변화 추적 및 알림
  - [ ] 애널리스트 등급 변화 추적
  - [ ] 애널리스트 의견을 추천 점수에 반영

---

## 📝 작업 우선순위 가이드

### 작업 선택 기준
1. **안정성**: 시스템 안정성에 직접적인 영향을 미치는 작업 우선
2. **수익성**: 직접적으로 수익에 영향을 미치는 작업 우선
3. **구현 복잡도**: 단순한 작업부터 시작하여 점진적으로 복잡도 증가
4. **의존성**: 다른 작업의 선행 조건이 되는 작업 우선

### 추천 작업 순서
1. **일일 최대 손실 제한** (리스크 관리, 구현 난이도: 중)
2. **최대 보유 종목 수 제한** (리스크 관리, 구현 난이도: 하)
3. **시간 기반 익절** (수익성, 구현 난이도: 중)
4. **장 시작/종료 시간 정확도 향상** (안정성, 구현 난이도: 중)
5. **공휴일 자동 감지** (안정성, 구현 난이도: 중)
6. **스케줄러 실행 실패 시 자동 재시도** (안정성, 구현 난이도: 중)
7. **주문 취소 로직** (기능 확장, 구현 난이도: 중)

---

**마지막 업데이트**: 2026-01-09 (멀티 유저 자동매수 지원 완료 및 하드코딩된 user_id 제거 완료)
