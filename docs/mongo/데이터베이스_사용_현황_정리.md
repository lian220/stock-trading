# ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš© í˜„í™© ì •ë¦¬

## ğŸ“Š ê°œìš”

MongoDB ì „í™˜ ì™„ë£Œ í›„ ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš© í˜„í™©ì„ ì •ë¦¬í•œ ë¬¸ì„œì…ë‹ˆë‹¤.

## âœ… í˜„ì¬ ìƒíƒœ: MongoDB ì „ìš©

**`app/services` ë””ë ‰í† ë¦¬ì˜ ëª¨ë“  ì„œë¹„ìŠ¤ íŒŒì¼ì´ MongoDB ì „ìš©ìœ¼ë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.**

- **ì €ì¥**: MongoDBì—ë§Œ ì €ì¥
- **ì¡°íšŒ**: MongoDBì—ì„œë§Œ ì¡°íšŒ
- **Supabase ì˜ì¡´ì„±**: `app/services`ì—ì„œ ì™„ì „íˆ ì œê±°ë¨

> âš ï¸ **ì°¸ê³ **: `scripts/utils/predict.py`ëŠ” ì•„ì§ Supabaseë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ë³„ë„ë¡œ ì „í™˜ì´ í•„ìš”í•©ë‹ˆë‹¤.

---

## 1ï¸âƒ£ MongoDB ì „ìš©ìœ¼ë¡œ ì „í™˜ ì™„ë£Œëœ ê¸°ëŠ¥

### ğŸ“‹ ì»¬ë ‰ì…˜ ëª©ë¡

| ì»¬ë ‰ì…˜ëª… | Supabase í…Œì´ë¸” (ì´ì „) | ìš©ë„ | ì‚¬ìš© ìœ„ì¹˜ | ìƒíƒœ |
|---------|----------------------|------|----------|------|
| `trading_configs` | `auto_trading_config` | ìë™ë§¤ë§¤ ì„¤ì • | `app/services/auto_trading_service.py` | âœ… **ì „í™˜ ì™„ë£Œ** |
| `trading_logs` | `auto_trading_logs` | ìë™ë§¤ë§¤ ì£¼ë¬¸ ê¸°ë¡ | `app/services/auto_trading_service.py` | âœ… **ì „í™˜ ì™„ë£Œ** |
| `access_tokens` | `access_tokens` | API ì ‘ê·¼ í† í° | `app/services/balance_service.py` | âœ… **ì „í™˜ ì™„ë£Œ** |
| `stock_recommendations` | `stock_recommendations` | ê¸°ìˆ ì  ë¶„ì„ ì¶”ì²œ | `app/services/stock_recommendation_service.py` | âœ… **ì „í™˜ ì™„ë£Œ** |
| `sentiment_analysis` | `ticker_sentiment_analysis` | ë‰´ìŠ¤ ê°ì • ë¶„ì„ | `app/services/stock_recommendation_service.py` | âœ… **ì „í™˜ ì™„ë£Œ** |
| `stock_analysis` | `stock_analysis_results` | AI ë¶„ì„ ê²°ê³¼ | `app/services/stock_recommendation_service.py` | âœ… **ì „í™˜ ì™„ë£Œ** |
| `daily_stock_data` | `economic_and_stock_data` | ê²½ì œ/ì£¼ê°€ ë°ì´í„° | `app/services/economic_service.py` | âœ… **ì „í™˜ ì™„ë£Œ** |
| `stocks` | `stock_ticker_mapping` | ì¢…ëª© ê¸°ë³¸ ì •ë³´ | `app/services/stock_service.py` | âœ… **ì „í™˜ ì™„ë£Œ** |

### ğŸ” ìƒì„¸ ì„¤ëª…

#### 1. `trading_configs` âœ… **ì „í™˜ ì™„ë£Œ**
- **ìš©ë„**: ìë™ë§¤ë§¤ ì„¤ì • (ì „ì—­/ì‚¬ìš©ìë³„)
- **ì‚¬ìš© ìœ„ì¹˜**: `app/services/auto_trading_service.py`
- **ë©”ì„œë“œ**: `get_auto_trading_config()`, `update_auto_trading_config()`, `_create_default_config()`

#### 2. `trading_logs` âœ… **ì „í™˜ ì™„ë£Œ**
- **ìš©ë„**: ìë™ë§¤ë§¤ ì£¼ë¬¸ ê¸°ë¡
- **ì‚¬ìš© ìœ„ì¹˜**: `app/services/auto_trading_service.py`
- **ë©”ì„œë“œ**: `_save_order_log()`, `_get_recent_orders()`

#### 3. `access_tokens` âœ… **ì „í™˜ ì™„ë£Œ**
- **ìš©ë„**: í•œêµ­íˆ¬ìì¦ê¶Œ API ì ‘ê·¼ í† í° ê´€ë¦¬
- **ì‚¬ìš© ìœ„ì¹˜**: `app/services/balance_service.py`
- **ë©”ì„œë“œ**: `get_access_token()`, `refresh_token_with_retry()`
- **íŠ¹ì§•**: `user_id` + `account_type` ê¸°ì¤€ upsert

#### 4. `stock_recommendations` âœ… **ì „í™˜ ì™„ë£Œ**
- **ìš©ë„**: ê¸°ìˆ ì  ì§€í‘œ ê¸°ë°˜ ì¶”ì²œ ë°ì´í„°
- **ì‚¬ìš© ìœ„ì¹˜**: `app/services/stock_recommendation_service.py`
- **ì €ì¥ ë°©ì‹**: upsert (date + ticker ê¸°ì¤€)
- **ì¡°íšŒ**: `get_combined_recommendations_with_technical_and_sentiment()`

#### 5. `sentiment_analysis` âœ… **ì „í™˜ ì™„ë£Œ**
- **ìš©ë„**: ë‰´ìŠ¤ ê°ì • ë¶„ì„ ê²°ê³¼
- **ì‚¬ìš© ìœ„ì¹˜**: `app/services/stock_recommendation_service.py`
- **ì €ì¥ ë°©ì‹**: upsert (ticker ê¸°ì¤€)
- **ì¡°íšŒ**: `get_combined_recommendations_with_technical_and_sentiment()`

#### 6. `stock_analysis` âœ… **ì „í™˜ ì™„ë£Œ**
- **ìš©ë„**: AI ë¶„ì„ ê²°ê³¼ (MAE, MSE, RMSE, Accuracy, ì¶”ì²œ ë“±)
- **ì‚¬ìš© ìœ„ì¹˜**: `app/services/stock_recommendation_service.py`
- **ì¡°íšŒ**: `get_stock_recommendations()`

#### 7. `daily_stock_data` âœ… **ì „í™˜ ì™„ë£Œ**
- **ìš©ë„**: ë‚ ì§œë³„ ê²½ì œ ì§€í‘œ + ì£¼ê°€ ë°ì´í„°
- **ì‚¬ìš© ìœ„ì¹˜**: `app/services/economic_service.py`
- **êµ¬ì¡°**:
  ```javascript
  {
    "date": "2025-12-12",
    "fred_indicators": {...},
    "yfinance_indicators": {...},
    "stocks": {...},
    "recommendations": {...},
    "sentiment": {...}
  }
  ```

---

## 2ï¸âƒ£ MongoDBë§Œ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ (ê¸°ì¡´)

### ğŸ“‹ ì»¬ë ‰ì…˜ ëª©ë¡

| ì»¬ë ‰ì…˜ëª… | ìš©ë„ | ì‚¬ìš© ìœ„ì¹˜ | ìƒíƒœ |
|---------|------|----------|------|
| `stocks` | ì¢…ëª© ê¸°ë³¸ ì •ë³´ | `app/services/stock_service.py` | âœ… ì‚¬ìš© ì¤‘ |
| `users` | ì‚¬ìš©ì ì •ë³´ | MongoDB ìŠ¤í‚¤ë§ˆ ì„¤ê³„ ë¬¸ì„œ | âš ï¸ ë¯¸êµ¬í˜„ |
| `user_stocks` | ì‚¬ìš©ìë³„ ê´€ì‹¬ ì¢…ëª© | MongoDB ìŠ¤í‚¤ë§ˆ ì„¤ê³„ ë¬¸ì„œ | âš ï¸ ë¯¸êµ¬í˜„ |
| `fred_indicators` | FRED ì§€í‘œ ë©”íƒ€ë°ì´í„° | `scripts/utils/predict.py` | âœ… ì‚¬ìš© ì¤‘ |
| `yfinance_indicators` | Yahoo Finance ì§€í‘œ ë©”íƒ€ë°ì´í„° | `scripts/utils/predict.py` | âœ… ì‚¬ìš© ì¤‘ |

---

## 3ï¸âƒ£ ì•„ì§ Supabaseë¥¼ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥

### âš ï¸ `scripts/utils/predict.py` (ë³„ë„ ì „í™˜ í•„ìš”)

| Supabase í…Œì´ë¸” | ìš©ë„ | ì „í™˜ ëŒ€ìƒ MongoDB ì»¬ë ‰ì…˜ |
|----------------|------|------------------------|
| `predicted_stocks` | AI ì˜ˆì¸¡ ê²°ê³¼ (Wide format) | `stock_predictions` |
| `stock_analysis_results` | AI ë¶„ì„ ê²°ê³¼ | `stock_analysis` |
| `stock_ticker_mapping` | ì¢…ëª© ë§¤í•‘ ì¡°íšŒ | `stocks` |

> ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” Colab/Vertex AIì—ì„œ ì‹¤í–‰ë˜ë¯€ë¡œ ë³„ë„ë¡œ ì „í™˜ì´ í•„ìš”í•©ë‹ˆë‹¤.

---

## ğŸ“Š ê¸°ëŠ¥ë³„ ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš© í˜„í™©

### ê²½ì œ ë°ì´í„° ìˆ˜ì§‘ ë° ì €ì¥

| ê¸°ëŠ¥ | Supabase | MongoDB | ë¹„ê³  |
|------|----------|---------|------|
| ë°ì´í„° ìˆ˜ì§‘ | âŒ | âœ… `daily_stock_data` | **MongoDB ì „ìš©** |
| ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ë‚ ì§œ ì¡°íšŒ | âŒ | âœ… `daily_stock_data` | **MongoDB ì „ìš©** |
| ë°ì´í„° ì €ì¥ | âŒ | âœ… `daily_stock_data` | **MongoDB ì „ìš©** |

### ê¸°ìˆ ì  ë¶„ì„

| ê¸°ëŠ¥ | Supabase | MongoDB | ë¹„ê³  |
|------|----------|---------|------|
| ê¸°ìˆ ì  ì§€í‘œ ìƒì„± | âŒ | âœ… `stock_recommendations` | **MongoDB ì „ìš©** |
| ê¸°ìˆ ì  ì§€í‘œ ì¡°íšŒ | âŒ | âœ… `stock_recommendations` | **MongoDB ì „ìš©** |
| ë‚ ì§œë³„ í†µí•© ì¡°íšŒ | âŒ | âœ… `daily_stock_data.recommendations` | **MongoDB ì „ìš©** |

### ë‰´ìŠ¤ ê°ì • ë¶„ì„

| ê¸°ëŠ¥ | Supabase | MongoDB | ë¹„ê³  |
|------|----------|---------|------|
| ê°ì • ë¶„ì„ ì €ì¥ | âŒ | âœ… `sentiment_analysis` | **MongoDB ì „ìš©** (upsert) |
| ê°ì • ë¶„ì„ ì¡°íšŒ | âŒ | âœ… `sentiment_analysis` | **MongoDB ì „ìš©** |
| ë‚ ì§œë³„ í†µí•© ì¡°íšŒ | âŒ | âœ… `daily_stock_data.sentiment` | **MongoDB ì „ìš©** |

### AI ë¶„ì„ ê²°ê³¼

| ê¸°ëŠ¥ | Supabase | MongoDB | ë¹„ê³  |
|------|----------|---------|------|
| ë¶„ì„ ê²°ê³¼ ì¡°íšŒ | âŒ | âœ… `stock_analysis` | **MongoDB ì „ìš©** |

### ìë™ë§¤ë§¤

| ê¸°ëŠ¥ | Supabase | MongoDB | ë¹„ê³  |
|------|----------|---------|------|
| ì„¤ì • ì¡°íšŒ/ì €ì¥ | âŒ | âœ… `trading_configs` | âœ… **ì „í™˜ ì™„ë£Œ** |
| ì£¼ë¬¸ ë¡œê·¸ ì €ì¥ | âŒ | âœ… `trading_logs` | âœ… **ì „í™˜ ì™„ë£Œ** |
| ì£¼ë¬¸ ë¡œê·¸ ì¡°íšŒ | âŒ | âœ… `trading_logs` | âœ… **ì „í™˜ ì™„ë£Œ** |

### í† í° ê´€ë¦¬

| ê¸°ëŠ¥ | Supabase | MongoDB | ë¹„ê³  |
|------|----------|---------|------|
| í† í° ì¡°íšŒ | âŒ | âœ… `access_tokens` | âœ… **ì „í™˜ ì™„ë£Œ** |
| í† í° ì €ì¥/ê°±ì‹  | âŒ | âœ… `access_tokens` | âœ… **ì „í™˜ ì™„ë£Œ** (upsert) |

### ì¢…ëª© ê´€ë¦¬

| ê¸°ëŠ¥ | Supabase | MongoDB | ë¹„ê³  |
|------|----------|---------|------|
| ì¢…ëª© ë§¤í•‘ ì¡°íšŒ | âŒ | âœ… `stocks` | âœ… **ì „í™˜ ì™„ë£Œ** |

---

## ğŸ¯ ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

### âœ… ì™„ë£Œëœ í•­ëª©

- [x] `auto_trading_config` â†’ `trading_configs` ì „í™˜
- [x] `auto_trading_logs` â†’ `trading_logs` ì „í™˜
- [x] `access_tokens` â†’ MongoDB `access_tokens` ì „í™˜
- [x] `stock_recommendations` ì¡°íšŒ â†’ MongoDB ì „ìš©
- [x] `ticker_sentiment_analysis` â†’ `sentiment_analysis` ì „í™˜ (upsert)
- [x] `stock_analysis_results` ì¡°íšŒ â†’ MongoDB `stock_analysis` ì „ìš©
- [x] `economic_and_stock_data` â†’ `daily_stock_data` ì „í™˜
- [x] `stock_ticker_mapping` â†’ `stocks` ì „í™˜
- [x] Supabase import ì œê±° (`app/services/*.py`)
- [x] Supabase Repository íŒŒì¼ ì‚­ì œ
- [x] `dependencies.py` MongoDB ì „ìš©ìœ¼ë¡œ ë³€ê²½

### â³ ë‚¨ì€ í•­ëª©

- [ ] `scripts/utils/predict.py` MongoDB ì „ìš©ìœ¼ë¡œ ì „í™˜
- [ ] `users` ì»¬ë ‰ì…˜ êµ¬í˜„
- [ ] `user_stocks` ì»¬ë ‰ì…˜ êµ¬í˜„
- [ ] ì‚¬ìš©ìë³„ ê´€ì‹¬ ì¢…ëª© ê´€ë¦¬ ê¸°ëŠ¥ êµ¬í˜„

---

## ğŸ“ ì‚­ì œëœ íŒŒì¼

MongoDB ì „í™˜ìœ¼ë¡œ ì¸í•´ ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” íŒŒì¼ë“¤:

- `app/db/supabase.py` - ë ˆê±°ì‹œ Supabase ë˜í¼
- `app/infrastructure/database/supabase_client.py` - Supabase í´ë¼ì´ì–¸íŠ¸
- `app/infrastructure/repositories/supabase_stock_repository.py` - Supabase Stock Repository
- `app/infrastructure/repositories/supabase_economic_repository.py` - Supabase Economic Repository

---

## ğŸ“Œ ì°¸ê³ ì‚¬í•­

1. **`config.py`ì˜ SUPABASE ì„¤ì • ìœ ì§€**
   - `scripts/utils/predict.py`ì—ì„œ ì•„ì§ ì‚¬ìš© ì¤‘
   - í•´ë‹¹ ìŠ¤í¬ë¦½íŠ¸ ì „í™˜ í›„ ì œê±° ê°€ëŠ¥

2. **MongoDB ì¸ë±ìŠ¤**
   - ê° ì»¬ë ‰ì…˜ì— ì ì ˆí•œ ì¸ë±ìŠ¤ê°€ ì„¤ì •ë˜ì–´ ìˆì–´ì•¼ ì„±ëŠ¥ ìµœì í™”
   - `scripts/setup_mongodb_schema.py`ë¡œ ì¸ë±ìŠ¤ ìƒì„±

3. **upsert íŒ¨í„´ ì‚¬ìš©**
   - `sentiment_analysis`: ticker ê¸°ì¤€ upsert
   - `access_tokens`: user_id + account_type ê¸°ì¤€ upsert
   - `trading_configs`: ìµœì‹  ì„¤ì • ì¡°íšŒ/ì—…ë°ì´íŠ¸
