# ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš© í˜„í™© ì •ë¦¬

## ğŸ“Š ê°œìš”

MongoDB ì „í™˜ì„ ìœ„í•œ í˜„ì¬ ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš© í˜„í™©ì„ ì •ë¦¬í•œ ë¬¸ì„œì…ë‹ˆë‹¤.

## âš ï¸ ì¤‘ìš”: ì¡°íšŒ vs ì €ì¥ êµ¬ë¶„

**í˜„ì¬ í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹ì˜ ì‹¤ì œ ë™ì‘**:
- **ì €ì¥**: Supabaseì™€ MongoDBì— **ë™ì‹œ ì €ì¥** (í•˜ì´ë¸Œë¦¬ë“œ)
- **ì¡°íšŒ**: 
  - âš ï¸ **í†µí•© ì¶”ì²œ ì‹œìŠ¤í…œ**: **Supabaseì—ì„œ ì¡°íšŒ** (`get_combined_recommendations_with_technical_and_sentiment()`)
  - **ì‹œê³„ì—´/ë‚ ì§œë³„ ë¶„ì„**: MongoDB ë³„ë„ í•¨ìˆ˜ ì‚¬ìš© (`get_daily_recommendations_from_mongodb()`, `get_stock_recommendation_history_from_mongodb()`)

**ì´ìœ **:
- í†µí•© ì¶”ì²œ ì‹œìŠ¤í…œì€ ì‹¤ì‹œê°„ ì¡°íšŒê°€ ì¤‘ìš”í•˜ë¯€ë¡œ Supabase ì‚¬ìš© (ìµœì í™”)
- MongoDBëŠ” ì‹œê³„ì—´ ë¶„ì„ ë° ë‚ ì§œë³„ í†µí•© ì¡°íšŒì— í™œìš© (ë³„ë„ API ì—”ë“œí¬ì¸íŠ¸)

---

## 1ï¸âƒ£ PostgreSQL(Supabase)ë§Œ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥

### ğŸ“‹ í…Œì´ë¸” ëª©ë¡

| í…Œì´ë¸”ëª… | ìš©ë„ | ì‚¬ìš© ìœ„ì¹˜ | ë§ˆì´ê·¸ë ˆì´ì…˜ í•„ìš”ì„± |
|---------|------|----------|-------------------|
| `stock_ticker_mapping` | ì¢…ëª©ëª…-í‹°ì»¤ ë§¤í•‘ | ~~`app/services/stock_recommendation_service.py`~~<br>~~`scripts/utils/predict.py`~~ | âœ… **ì™„ë£Œ** (MongoDB `stocks` ì»¬ë ‰ì…˜ìœ¼ë¡œ ì „í™˜ ì™„ë£Œ) |
| `predicted_stocks` | AI ì˜ˆì¸¡ ê²°ê³¼ (ë‚ ì§œë³„ ì˜ˆì¸¡/ì‹¤ì œ ê°€ê²©) | `scripts/utils/predict.py` | âœ… **í•˜ì´ë¸Œë¦¬ë“œ** (Supabase + MongoDB `stock_predictions`) |
| `stock_analysis_results` | AI ë¶„ì„ ê²°ê³¼ (í‰ê°€ ì§€í‘œ + ì¶”ì²œ) | `app/services/stock_recommendation_service.py`<br>`scripts/utils/predict.py` | âœ… **í•˜ì´ë¸Œë¦¬ë“œ** (Supabase + MongoDB `stock_analysis`) |
| `stock_daily_volume` | ì¼ì¼ ê±°ë˜ëŸ‰ | `scripts/utils/predict.py` | âœ… í•„ìš” (MongoDB `daily_stock_data.volumes` í•„ë“œë¡œ) |
| `auto_trading_config` | ìë™ë§¤ë§¤ ì„¤ì • | `app/services/auto_trading_service.py` | âœ… í•„ìš” (MongoDB `trading_configs` ì»¬ë ‰ì…˜ìœ¼ë¡œ) |
| `auto_trading_logs` | ìë™ë§¤ë§¤ ì£¼ë¬¸ ê¸°ë¡ | `app/services/auto_trading_service.py` | âœ… í•„ìš” (MongoDB `trading_logs` ì»¬ë ‰ì…˜ìœ¼ë¡œ) |

### ğŸ” ìƒì„¸ ì„¤ëª…

#### 1. `stock_ticker_mapping` âœ… **ì „í™˜ ì™„ë£Œ**
- **ìš©ë„**: í•œê¸€ ì£¼ì‹ëª…ê³¼ í‹°ì»¤ ì‹¬ë³¼ ë§¤í•‘
- **ì´ì „ ì‚¬ìš© ìœ„ì¹˜**:
  - ~~`app/services/stock_recommendation_service.py`: `load_stock_ticker_mapping()`~~ â†’ MongoDB `stocks` ì»¬ë ‰ì…˜ ì‚¬ìš©
  - ~~`scripts/utils/predict.py`: `get_target_columns_from_db()`~~ â†’ MongoDB `stocks` ì»¬ë ‰ì…˜ ì‚¬ìš©
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: âœ… **ì™„ë£Œ** - MongoDB `stocks` ì»¬ë ‰ì…˜ìœ¼ë¡œ ì „í™˜ ì™„ë£Œ

#### 2. `predicted_stocks` âœ… **í•˜ì´ë¸Œë¦¬ë“œ ì™„ë£Œ**
- **ìš©ë„**: AI ëª¨ë¸ ì˜ˆì¸¡ ê²°ê³¼ ì €ì¥ (ë‚ ì§œë³„ ì˜ˆì¸¡ê°’/ì‹¤ì œê°’)
- **ì‚¬ìš© ìœ„ì¹˜**:
  - `scripts/utils/predict.py`: `save_predictions_to_db()`, `get_predictions_from_db()`
- **ì €ì¥ ë°©ì‹**: âœ… **í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²•**
  - **Supabase**: `predicted_stocks` í…Œì´ë¸” (ë‚ ì§œë³„ í•œ í–‰ì— ëª¨ë“  ì¢…ëª©)
  - **MongoDB**: `stock_predictions` ì»¬ë ‰ì…˜ (ì¢…ëª©ë³„ë¡œ ë¶„ë¦¬ëœ ë¬¸ì„œ)
- **íŠ¹ì§•**: 
  - Supabase: Wide format (ì¢…ëª©ì´ ì»¬ëŸ¼ìœ¼ë¡œ í•˜ë“œì½”ë”©)
  - MongoDB: Long format (ì¢…ëª©ë³„ ë¬¸ì„œ, ì¡°íšŒ ìµœì í™”)
- **íš¨ìœ¨ì„± ê°œì„ **:
  - MongoDB ì €ì¥ ì‹œ `bulk_write` ì‚¬ìš© (ë°°ì¹˜ ì²˜ë¦¬)
  - ì¸ë±ìŠ¤: `(date, ticker)` unique, `date`, `(ticker, date)` ë³µí•© ì¸ë±ìŠ¤

#### 3. `stock_analysis_results` âœ… **í•˜ì´ë¸Œë¦¬ë“œ ì™„ë£Œ**
- **ìš©ë„**: AI ë¶„ì„ ê²°ê³¼ (MAE, MSE, RMSE, Accuracy, ì¶”ì²œ ë“±)
- **ì‚¬ìš© ìœ„ì¹˜**:
  - `scripts/utils/predict.py`: `save_analysis_to_db()`
  - `app/services/stock_recommendation_service.py`: `get_stock_recommendations()`
- **ì €ì¥ ë°©ì‹**: âœ… **í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²•**
  - **Supabase**: `stock_analysis_results` í…Œì´ë¸” (ì¢…ëª©ë³„ í•œ í–‰ì— ëª¨ë“  ë¶„ì„ ì§€í‘œ)
  - **MongoDB**: `stock_analysis` ì»¬ë ‰ì…˜ (ì¢…ëª©ë³„ ë¬¸ì„œ, êµ¬ì¡°í™”ëœ í˜•íƒœ)
- **íš¨ìœ¨ì„± ê°œì„ **:
  - MongoDB ì €ì¥ ì‹œ `bulk_write` ì‚¬ìš© (ë°°ì¹˜ ì²˜ë¦¬)
  - ì¸ë±ìŠ¤: `(date, ticker, user_id)` ë³µí•© ì¸ë±ìŠ¤, `(user_id, date)` ì¸ë±ìŠ¤

#### 4. `stock_daily_volume` âœ… **ê°œì„  ì™„ë£Œ**
- **ìš©ë„**: ì¼ì¼ ê±°ë˜ëŸ‰ ë°ì´í„°
- **ì‚¬ìš© ìœ„ì¹˜**:
  - `scripts/utils/predict.py`: ë°ì´í„° ìˆ˜ì§‘ ì‹œ ì‚¬ìš©
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: âœ… **ê°œì„  ì™„ë£Œ**
  - MongoDB `daily_stock_data.volumes` í•„ë“œë¡œ í†µí•©
  - `stock_volumes` ì»¬ë ‰ì…˜ì€ ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ (deprecated)

#### 5. `auto_trading_config`
- **ìš©ë„**: ìë™ë§¤ë§¤ ì„¤ì • (ì „ì—­ ì„¤ì •)
- **ì‚¬ìš© ìœ„ì¹˜**:
  - `app/services/auto_trading_service.py`: `get_auto_trading_config()`, `update_auto_trading_config()`
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: MongoDB `trading_configs` ì»¬ë ‰ì…˜ìœ¼ë¡œ ì „í™˜ í•„ìš”
- **ê°œì„ ì **: ê°œì¸ë³„ ì„¤ì • ì§€ì› (user_id ì¶”ê°€)

#### 6. `auto_trading_logs`
- **ìš©ë„**: ìë™ë§¤ë§¤ ì£¼ë¬¸ ê¸°ë¡
- **ì‚¬ìš© ìœ„ì¹˜**:
  - `app/services/auto_trading_service.py`: `_save_order_log()`, `_get_recent_orders()`
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: MongoDB `trading_logs` ì»¬ë ‰ì…˜ìœ¼ë¡œ ì „í™˜ í•„ìš”
- **ê°œì„ ì **: ì‚¬ìš©ìë³„ ë¡œê·¸ ê´€ë¦¬ (user_id ì¶”ê°€)

---

## 2ï¸âƒ£ MongoDBë§Œ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥

### ğŸ“‹ ì»¬ë ‰ì…˜ ëª©ë¡

| ì»¬ë ‰ì…˜ëª… | ìš©ë„ | ì‚¬ìš© ìœ„ì¹˜ | ìƒíƒœ |
|---------|------|----------|------|
| `stocks` | ì¢…ëª© ê¸°ë³¸ ì •ë³´ | `scripts/create_mongodb_collections.py`<br>`scripts/setup_mongodb_schema.py` | âœ… ì¤€ë¹„ ì™„ë£Œ |
| `users` | ì‚¬ìš©ì ì •ë³´ | MongoDB ìŠ¤í‚¤ë§ˆ ì„¤ê³„ ë¬¸ì„œ | âš ï¸ ë¯¸êµ¬í˜„ |
| `user_stocks` | ì‚¬ìš©ìë³„ ê´€ì‹¬ ì¢…ëª© | MongoDB ìŠ¤í‚¤ë§ˆ ì„¤ê³„ ë¬¸ì„œ | âš ï¸ ë¯¸êµ¬í˜„ |
| `economic_data` | ê²½ì œ ì§€í‘œ ë°ì´í„° (ë³„ë„ ì»¬ë ‰ì…˜) | MongoDB ìŠ¤í‚¤ë§ˆ ì„¤ê³„ ë¬¸ì„œ | âš ï¸ ë¯¸ì‚¬ìš© (daily_stock_data ì‚¬ìš© ì¤‘) |
| `fred_indicators` | FRED ì§€í‘œ ë©”íƒ€ë°ì´í„° | `scripts/create_mongodb_collections.py`<br>`scripts/utils/predict.py` | âœ… ì‚¬ìš© ì¤‘ |
| `yfinance_indicators` | Yahoo Finance ì§€í‘œ ë©”íƒ€ë°ì´í„° | `scripts/create_mongodb_collections.py`<br>`scripts/utils/predict.py` | âœ… ì‚¬ìš© ì¤‘ |

### ğŸ” ìƒì„¸ ì„¤ëª…

#### 1. `stocks`
- **ìš©ë„**: ì¢…ëª© ê¸°ë³¸ ì •ë³´ (ticker, stock_name, is_etf, leverage_ticker ë“±)
- **ìƒíƒœ**: ì»¬ë ‰ì…˜ ìƒì„± ì™„ë£Œ, ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ í•„ìš”
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: âœ… **ì™„ë£Œ** - `stock_ticker_mapping` â†’ `stocks` ì „í™˜ ì™„ë£Œ

#### 2. `fred_indicators` / `yfinance_indicators`
- **ìš©ë„**: ê²½ì œ ì§€í‘œ ë©”íƒ€ë°ì´í„° (í™œì„±í™” ì—¬ë¶€, ì´ë¦„, ì½”ë“œ ë“±)
- **ìƒíƒœ**: âœ… ì‚¬ìš© ì¤‘
- **ì‚¬ìš© ìœ„ì¹˜**: `scripts/utils/predict.py`ì—ì„œ í™œì„±í™”ëœ ì§€í‘œ ëª©ë¡ ì¡°íšŒ

#### 3. `users` / `user_stocks`
- **ìš©ë„**: ì‚¬ìš©ì ì •ë³´ ë° ì‚¬ìš©ìë³„ ê´€ì‹¬ ì¢…ëª©
- **ìƒíƒœ**: âš ï¸ ìŠ¤í‚¤ë§ˆ ì„¤ê³„ë§Œ ì™„ë£Œ, ì‹¤ì œ ì‚¬ìš© ë¯¸êµ¬í˜„

---

## 3ï¸âƒ£ ë‘˜ ë‹¤ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ (í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²•)

### ğŸ“‹ í…Œì´ë¸”/ì»¬ë ‰ì…˜ ëª©ë¡

| Supabase í…Œì´ë¸” | MongoDB ì»¬ë ‰ì…˜/í•„ë“œ | ìš©ë„ | í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹ |
|----------------|-------------------|------|---------------|
| `economic_and_stock_data` | `daily_stock_data` | ì£¼ê°€ ë°ì´í„° + ê²½ì œ ì§€í‘œ | âœ… ë‚ ì§œë³„ í†µí•© ì¡°íšŒìš© |
| `stock_recommendations` | `stock_recommendations`<br>`daily_stock_data.recommendations` | ê¸°ìˆ ì  ë¶„ì„ ì¶”ì²œ | âœ… í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²• |
| `predicted_stocks` | `stock_predictions` | AI ì˜ˆì¸¡ ê²°ê³¼ | âœ… í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²• |
| `ticker_sentiment_analysis` | `sentiment_analysis`<br>`daily_stock_data.sentiment` | ë‰´ìŠ¤ ê°ì • ë¶„ì„ | âœ… í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²• |
| `predicted_stocks` | `stock_predictions` | AI ì˜ˆì¸¡ ê²°ê³¼ | âœ… í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²• |

### ğŸ” ìƒì„¸ ì„¤ëª…

#### 1. ê²½ì œ ë°ì´í„° (`economic_and_stock_data` â†” `daily_stock_data`)

**Supabase**: `economic_and_stock_data`
- **ìš©ë„**: ë‚ ì§œë³„ ì£¼ê°€ ë°ì´í„° + ê²½ì œ ì§€í‘œ (Wide format)
- **ì‚¬ìš© ìœ„ì¹˜**: `app/services/economic_service.py`

**MongoDB**: `daily_stock_data`
- **ìš©ë„**: ë‚ ì§œë³„ í†µí•© ë°ì´í„° (êµ¬ì¡°í™”ëœ í˜•íƒœ)
- **êµ¬ì¡°**:
  ```javascript
  {
    "date": "2025-12-12",
    "fred_indicators": {...},
    "yfinance_indicators": {...},
    "stocks": {...},
    "recommendations": {...},  // ê¸°ìˆ ì  ë¶„ì„
    "sentiment": {...}         // ë‰´ìŠ¤ ê°ì • ë¶„ì„
  }
  ```
- **ì‚¬ìš© ìœ„ì¹˜**: `app/services/economic_service.py` (ì €ì¥), `app/services/stock_recommendation_service.py` (ì¡°íšŒ)

**í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹**:
- Supabase ì €ì¥ í›„ MongoDBì—ë„ ì €ì¥
- MongoDBëŠ” êµ¬ì¡°í™”ëœ í˜•íƒœë¡œ ì €ì¥ (ì¹´í…Œê³ ë¦¬ë³„ ë¶„ë¦¬)
- ì¡°íšŒëŠ” MongoDB ìš°ì„ , ì‹¤íŒ¨ ì‹œ Supabase fallback

#### 2. ê¸°ìˆ ì  ë¶„ì„ (`stock_recommendations` â†” `stock_recommendations` + `daily_stock_data.recommendations`)

**Supabase**: `stock_recommendations`
- **ìš©ë„**: ê¸°ìˆ ì  ì§€í‘œ ê¸°ë°˜ ì¶”ì²œ ë°ì´í„°
- **ì‚¬ìš© ìœ„ì¹˜**: `app/services/stock_recommendation_service.py`
- âš ï¸ **ì¡°íšŒ**: í†µí•© ì¶”ì²œ ì‹œìŠ¤í…œì—ì„œ **Supabaseì—ì„œ ì¡°íšŒ** (`get_combined_recommendations_with_technical_and_sentiment()`)
  - `supabase.table("stock_recommendations").select("*")` ë¡œ ì¡°íšŒ

**MongoDB**: 
- `stock_recommendations` ì»¬ë ‰ì…˜: ì¢…ëª©ë³„ ì‹œê³„ì—´ ì¡°íšŒìš© (ì €ì¥ë§Œ, ì¡°íšŒëŠ” ë³„ë„ í•¨ìˆ˜)
- `daily_stock_data.recommendations` í•„ë“œ: ë‚ ì§œë³„ í†µí•© ì¡°íšŒìš© (ì €ì¥ë§Œ, ì¡°íšŒëŠ” ë³„ë„ í•¨ìˆ˜)

**í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹**:
- **ì €ì¥**: Supabase ì €ì¥ í›„ MongoDBì—ë„ ì €ì¥ (ë™ì‹œ ì €ì¥)
- **ì¡°íšŒ**: 
  - âš ï¸ **í†µí•© ì¶”ì²œ ì‹œìŠ¤í…œ**: Supabaseì—ì„œ ì¡°íšŒ (ì‹¤ì‹œê°„ ì¡°íšŒ ìµœì í™”)
  - **ì‹œê³„ì—´ ë¶„ì„**: MongoDB ë³„ë„ í•¨ìˆ˜ ì‚¬ìš© (`get_stock_recommendation_history_from_mongodb()`)
  - **ë‚ ì§œë³„ í†µí•©**: MongoDB ë³„ë„ í•¨ìˆ˜ ì‚¬ìš© (`get_daily_recommendations_from_mongodb()`)
- ë‘ ì €ì¥ì†ŒëŠ” ë™ê¸°í™”ë˜ì–´ ìœ ì§€
- ìš©ë„ì— ë”°ë¼ ë¶„ë¦¬ ì‚¬ìš©:
  - **í†µí•© ì¶”ì²œ ì¡°íšŒ**: Supabase `stock_recommendations` í…Œì´ë¸”
  - **ë‚ ì§œë³„ í†µí•© ì¡°íšŒ**: MongoDB `daily_stock_data.recommendations` (ë³„ë„ í•¨ìˆ˜)
  - **ì¢…ëª©ë³„ ì‹œê³„ì—´ ì¡°íšŒ**: MongoDB `stock_recommendations` ì»¬ë ‰ì…˜ (ë³„ë„ í•¨ìˆ˜)

#### 3. ë‰´ìŠ¤ ê°ì • ë¶„ì„ (`ticker_sentiment_analysis` â†” `sentiment_analysis` + `daily_stock_data.sentiment`)

**Supabase**: `ticker_sentiment_analysis`
- **ìš©ë„**: ë‰´ìŠ¤ ê°ì • ë¶„ì„ ê²°ê³¼
- **ì‚¬ìš© ìœ„ì¹˜**: `app/services/stock_recommendation_service.py`
- âš ï¸ **ì¡°íšŒ**: í†µí•© ì¶”ì²œ ì‹œìŠ¤í…œì—ì„œ **Supabaseì—ì„œ ì¡°íšŒ** (`get_combined_recommendations_with_technical_and_sentiment()`)
  - `supabase.table("ticker_sentiment_analysis").select("*").gte("average_sentiment_score", 0.15)` ë¡œ ì¡°íšŒ

**MongoDB**:
- `sentiment_analysis` ì»¬ë ‰ì…˜: ì¢…ëª©ë³„ ì‹œê³„ì—´ ì¡°íšŒìš© (ì €ì¥ë§Œ, ì¡°íšŒëŠ” ë³„ë„ í•¨ìˆ˜)
- `daily_stock_data.sentiment` í•„ë“œ: ë‚ ì§œë³„ í†µí•© ì¡°íšŒìš© (ì €ì¥ë§Œ, ì¡°íšŒëŠ” ë³„ë„ í•¨ìˆ˜)

**í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹**:
- **ì €ì¥**: Supabase ì €ì¥ í›„ MongoDBì—ë„ ì €ì¥ (ë™ì‹œ ì €ì¥)
- **ì¡°íšŒ**: 
  - âš ï¸ **í†µí•© ì¶”ì²œ ì‹œìŠ¤í…œ**: Supabaseì—ì„œ ì¡°íšŒ (ì‹¤ì‹œê°„ ì¡°íšŒ ìµœì í™”)
  - **ì‹œê³„ì—´ ë¶„ì„**: MongoDB ë³„ë„ í•¨ìˆ˜ ì‚¬ìš© (í–¥í›„ êµ¬í˜„ ì˜ˆì •)
  - **ë‚ ì§œë³„ í†µí•©**: MongoDB ë³„ë„ í•¨ìˆ˜ ì‚¬ìš© (`get_daily_recommendations_from_mongodb()`)
- ë‘ ì €ì¥ì†ŒëŠ” ë™ê¸°í™”ë˜ì–´ ìœ ì§€
- ìš©ë„ì— ë”°ë¼ ë¶„ë¦¬ ì‚¬ìš©:
  - **í†µí•© ì¶”ì²œ ì¡°íšŒ**: Supabase `ticker_sentiment_analysis` í…Œì´ë¸”
  - **ë‚ ì§œë³„ í†µí•© ì¡°íšŒ**: MongoDB `daily_stock_data.sentiment` (ë³„ë„ í•¨ìˆ˜)
  - **ì¢…ëª©ë³„ ì‹œê³„ì—´ ì¡°íšŒ**: MongoDB `sentiment_analysis` ì»¬ë ‰ì…˜ (ë³„ë„ í•¨ìˆ˜, í–¥í›„ êµ¬í˜„)

#### 4. AI ì˜ˆì¸¡ ê²°ê³¼ (`predicted_stocks` â†” `stock_predictions`) âœ… **ì™„ë£Œ**

**Supabase**: `predicted_stocks`
- **ìš©ë„**: ë‚ ì§œë³„ í•œ í–‰ì— ëª¨ë“  ì¢…ëª©ì˜ ì˜ˆì¸¡ê°’/ì‹¤ì œê°’ (Wide format)
- **ì‚¬ìš© ìœ„ì¹˜**: `scripts/utils/predict.py`
- **íŠ¹ì§•**: ì¢…ëª©ì´ ì»¬ëŸ¼ìœ¼ë¡œ í•˜ë“œì½”ë”©

**MongoDB**: `stock_predictions`
- **ìš©ë„**: ì¢…ëª©ë³„ë¡œ ë¶„ë¦¬ëœ ë¬¸ì„œ (Long format)
- **íŠ¹ì§•**: ì¢…ëª©ë³„ ì‹œê³„ì—´ ë¶„ì„ì— ìµœì í™”

**í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹**:
- Supabase ì €ì¥ í›„ MongoDBì—ë„ ì €ì¥
- `bulk_write`ë¥¼ ì‚¬ìš©í•œ ë°°ì¹˜ ì²˜ë¦¬ë¡œ ì„±ëŠ¥ ìµœì í™”
- ë‘ ì €ì¥ì†ŒëŠ” ë™ê¸°í™”ë˜ì–´ ìœ ì§€
- ìš©ë„ì— ë”°ë¼ ë¶„ë¦¬ ì‚¬ìš©:
  - ë‚ ì§œë³„ ì „ì²´ ì¡°íšŒ: `predicted_stocks` (Supabase, Wide format) ë˜ëŠ” `daily_stock_data.predictions` (MongoDB)
  - ì¢…ëª©ë³„ ì‹œê³„ì—´: `stock_predictions` (MongoDB, Long format)

**íš¨ìœ¨ì„± ê°œì„ **:
- MongoDB ì €ì¥ ì‹œ `bulk_write` ì‚¬ìš© (ë°°ì¹˜ ì²˜ë¦¬)
- ì¸ë±ìŠ¤: `(date, ticker)` unique, `date`, `(ticker, date)` ë³µí•© ì¸ë±ìŠ¤
- `daily_stock_data.predictions` í•„ë“œ ì¶”ê°€ë¡œ ë‚ ì§œë³„ í†µí•© ì¡°íšŒ ìµœì í™”

#### 5. AI ë¶„ì„ ê²°ê³¼ (`stock_analysis_results` â†” `stock_analysis`) âœ… **ì™„ë£Œ**

**Supabase**: `stock_analysis_results`
- **ìš©ë„**: ì¢…ëª©ë³„ í•œ í–‰ì— ëª¨ë“  ë¶„ì„ ì§€í‘œ (MAE, MSE, RMSE, Accuracy, ì¶”ì²œ ë“±)
- **ì‚¬ìš© ìœ„ì¹˜**: 
  - `scripts/utils/predict.py` (ì €ì¥)
  - `app/services/stock_recommendation_service.py` (ì¡°íšŒ)
- **íŠ¹ì§•**: ì¢…ëª©ë³„ ë¶„ì„ ê²°ê³¼
- âš ï¸ **ì¡°íšŒ**: í†µí•© ì¶”ì²œ ì‹œìŠ¤í…œì—ì„œ **Supabaseì—ì„œ ì¡°íšŒ** (`get_stock_recommendations()`)
  - `supabase.table("stock_analysis_results").select("*")` ë¡œ ì¡°íšŒ

**MongoDB**: `stock_analysis`
- **ìš©ë„**: ì¢…ëª©ë³„ ë¬¸ì„œ (êµ¬ì¡°í™”ëœ í˜•íƒœ)
- **íŠ¹ì§•**: metrics, predictions ê°ì²´ë¡œ êµ¬ì¡°í™”
- **ì €ì¥ë§Œ í•˜ê³ , ì¡°íšŒëŠ” Supabase ì‚¬ìš©**

**í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹**:
- **ì €ì¥**: Supabase ì €ì¥ í›„ MongoDBì—ë„ ì €ì¥ (ë™ì‹œ ì €ì¥)
- **ì¡°íšŒ**: 
  - âš ï¸ **í†µí•© ì¶”ì²œ ì‹œìŠ¤í…œ**: Supabaseì—ì„œ ì¡°íšŒ (ì‹¤ì‹œê°„ ì¡°íšŒ ìµœì í™”)
  - **ì‹œê³„ì—´ ë¶„ì„**: MongoDB ë³„ë„ í•¨ìˆ˜ ì‚¬ìš© (í–¥í›„ êµ¬í˜„ ì˜ˆì •)
  - **ë‚ ì§œë³„ í†µí•©**: MongoDB `daily_stock_data.analysis` í•„ë“œ (ë³„ë„ í•¨ìˆ˜)
- `bulk_write`ë¥¼ ì‚¬ìš©í•œ ë°°ì¹˜ ì²˜ë¦¬ë¡œ ì„±ëŠ¥ ìµœì í™”
- ë‘ ì €ì¥ì†ŒëŠ” ë™ê¸°í™”ë˜ì–´ ìœ ì§€
- ìš©ë„ì— ë”°ë¼ ë¶„ë¦¬ ì‚¬ìš©:
  - **í†µí•© ì¶”ì²œ ì¡°íšŒ**: Supabase `stock_analysis_results` í…Œì´ë¸”
  - **ë‚ ì§œë³„ í†µí•© ì¡°íšŒ**: MongoDB `daily_stock_data.analysis` (ë³„ë„ í•¨ìˆ˜)
  - **ì¢…ëª©ë³„ ì‹œê³„ì—´ ë¶„ì„**: MongoDB `stock_analysis` ì»¬ë ‰ì…˜ (ë³„ë„ í•¨ìˆ˜, í–¥í›„ êµ¬í˜„)

**íš¨ìœ¨ì„± ê°œì„ **:
- MongoDB ì €ì¥ ì‹œ `bulk_write` ì‚¬ìš© (ë°°ì¹˜ ì²˜ë¦¬)
- ì¸ë±ìŠ¤: `(date, ticker, user_id)` ë³µí•© ì¸ë±ìŠ¤, `(user_id, date)` ì¸ë±ìŠ¤
- `daily_stock_data.analysis` í•„ë“œ ì¶”ê°€ë¡œ ë‚ ì§œë³„ í†µí•© ì¡°íšŒ ìµœì í™”

---

## ğŸ“Š ê¸°ëŠ¥ë³„ ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš© í˜„í™©

### ê²½ì œ ë°ì´í„° ìˆ˜ì§‘ ë° ì €ì¥

| ê¸°ëŠ¥ | Supabase | MongoDB | ë¹„ê³  |
|------|----------|---------|------|
| ë°ì´í„° ìˆ˜ì§‘ | âœ… `economic_and_stock_data` | âœ… `daily_stock_data` | í•˜ì´ë¸Œë¦¬ë“œ |
| ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ë‚ ì§œ ì¡°íšŒ | âœ… (fallback) | âœ… (ìš°ì„ ) | MongoDB ìš°ì„  |
| ë°ì´í„° ì €ì¥ | âœ… | âœ… | ë™ì‹œ ì €ì¥ |

### AI ì˜ˆì¸¡ ë° ë¶„ì„

| ê¸°ëŠ¥ | Supabase | MongoDB | ë¹„ê³  |
|------|----------|---------|------|
| ì˜ˆì¸¡ ê²°ê³¼ ì €ì¥ | âœ… `predicted_stocks` | âœ… `stock_predictions` | âœ… **í•˜ì´ë¸Œë¦¬ë“œ ì™„ë£Œ** |
| ë¶„ì„ ê²°ê³¼ ì €ì¥ | âœ… `stock_analysis_results` | âœ… `stock_analysis` | âœ… **í•˜ì´ë¸Œë¦¬ë“œ ì™„ë£Œ** |
| ì˜ˆì¸¡ ë°ì´í„° ì¡°íšŒ | âœ… `predicted_stocks` | âœ… `stock_predictions` | âœ… **í•˜ì´ë¸Œë¦¬ë“œ ì™„ë£Œ** |
| ë¶„ì„ ê²°ê³¼ ì¡°íšŒ | âœ… `stock_analysis_results` | âœ… `stock_analysis` | âœ… **í•˜ì´ë¸Œë¦¬ë“œ ì™„ë£Œ** |

### ê¸°ìˆ ì  ë¶„ì„

| ê¸°ëŠ¥ | Supabase | MongoDB | ë¹„ê³  |
|------|----------|---------|------|
| ê¸°ìˆ ì  ì§€í‘œ ìƒì„± | âœ… `stock_recommendations` | âœ… `stock_recommendations`<br>`daily_stock_data.recommendations` | í•˜ì´ë¸Œë¦¬ë“œ ì €ì¥ |
| ê¸°ìˆ ì  ì§€í‘œ ì¡°íšŒ (í†µí•© ì¶”ì²œ) | âš ï¸ **`stock_recommendations`** | âŒ | âš ï¸ **Supabaseì—ì„œ ì¡°íšŒ** |
| ë‚ ì§œë³„ í†µí•© ì¡°íšŒ | âŒ | âœ… `daily_stock_data.recommendations` | MongoDB ì „ìš© (ë³„ë„ í•¨ìˆ˜) |
| ì¢…ëª©ë³„ ì‹œê³„ì—´ ì¡°íšŒ | âŒ | âœ… `stock_recommendations` | MongoDB ì „ìš© (ë³„ë„ í•¨ìˆ˜) |

### ë‰´ìŠ¤ ê°ì • ë¶„ì„

| ê¸°ëŠ¥ | Supabase | MongoDB | ë¹„ê³  |
|------|----------|---------|------|
| ê°ì • ë¶„ì„ ì €ì¥ | âœ… `ticker_sentiment_analysis` | âœ… `sentiment_analysis`<br>`daily_stock_data.sentiment` | í•˜ì´ë¸Œë¦¬ë“œ ì €ì¥ |
| ê°ì • ë¶„ì„ ì¡°íšŒ (í†µí•© ì¶”ì²œ) | âš ï¸ **`ticker_sentiment_analysis`** | âŒ | âš ï¸ **Supabaseì—ì„œ ì¡°íšŒ** |
| ë‚ ì§œë³„ í†µí•© ì¡°íšŒ | âŒ | âœ… `daily_stock_data.sentiment` | MongoDB ì „ìš© (ë³„ë„ í•¨ìˆ˜) |
| ì¢…ëª©ë³„ ì‹œê³„ì—´ ì¡°íšŒ | âŒ | âœ… `sentiment_analysis` | MongoDB ì „ìš© (ë³„ë„ í•¨ìˆ˜, í–¥í›„ êµ¬í˜„) |

### AI ì˜ˆì¸¡ ê²°ê³¼

| ê¸°ëŠ¥ | Supabase | MongoDB | ë¹„ê³  |
|------|----------|---------|------|
| ì˜ˆì¸¡ ê²°ê³¼ ì €ì¥ | âœ… `predicted_stocks` | âœ… `stock_predictions` | í•˜ì´ë¸Œë¦¬ë“œ |
| ì˜ˆì¸¡ ê²°ê³¼ ì¡°íšŒ | âœ… `predicted_stocks` | âœ… `stock_predictions` | í•˜ì´ë¸Œë¦¬ë“œ |
| ë‚ ì§œë³„ ì „ì²´ ì¡°íšŒ | âœ… `predicted_stocks` (Wide format) | âŒ | Supabase ì „ìš© |
| ì¢…ëª©ë³„ ì‹œê³„ì—´ ì¡°íšŒ | âŒ | âœ… `stock_predictions` (Long format) | MongoDB ì „ìš© |

### AI ë¶„ì„ ê²°ê³¼

| ê¸°ëŠ¥ | Supabase | MongoDB | ë¹„ê³  |
|------|----------|---------|------|
| ë¶„ì„ ê²°ê³¼ ì €ì¥ | âœ… `stock_analysis_results` | âœ… `stock_analysis` | í•˜ì´ë¸Œë¦¬ë“œ ì €ì¥ |
| ë¶„ì„ ê²°ê³¼ ì¡°íšŒ (í†µí•© ì¶”ì²œ) | âš ï¸ **`stock_analysis_results`** | âŒ | âš ï¸ **Supabaseì—ì„œ ì¡°íšŒ** |
| ì¢…ëª©ë³„ ë¶„ì„ ì¡°íšŒ | âœ… `stock_analysis_results` | âœ… `stock_analysis` | ë‘˜ ë‹¤ ì§€ì› (ë³„ë„ í•¨ìˆ˜) |
| ì¢…ëª©ë³„ ì‹œê³„ì—´ ì¡°íšŒ | âŒ | âœ… `stock_analysis` (Long format) | MongoDB ì „ìš© (ë³„ë„ í•¨ìˆ˜, í–¥í›„ êµ¬í˜„) |

### ìë™ë§¤ë§¤

| ê¸°ëŠ¥ | Supabase | MongoDB | ë¹„ê³  |
|------|----------|---------|------|
| ì„¤ì • ì¡°íšŒ/ì €ì¥ | âœ… `auto_trading_config` | âŒ | ì „í™˜ í•„ìš” |
| ì£¼ë¬¸ ë¡œê·¸ ì €ì¥ | âœ… `auto_trading_logs` | âŒ | ì „í™˜ í•„ìš” |
| ì£¼ë¬¸ ë¡œê·¸ ì¡°íšŒ | âœ… `auto_trading_logs` | âŒ | ì „í™˜ í•„ìš” |

### ì¢…ëª© ê´€ë¦¬

| ê¸°ëŠ¥ | Supabase | MongoDB | ë¹„ê³  |
|------|----------|---------|------|
| ì¢…ëª© ë§¤í•‘ ì¡°íšŒ | ~~âœ… `stock_ticker_mapping`~~ | âœ… `stocks` | âœ… **ì „í™˜ ì™„ë£Œ** |
| ê±°ë˜ëŸ‰ ë°ì´í„° | âœ… `stock_daily_volume` | âœ… `daily_stock_data.volumes` | âœ… **í†µí•© ì™„ë£Œ** |

---

## ğŸ¯ MongoDB ì „í™˜ ìš°ì„ ìˆœìœ„

### Phase 1: í•˜ì´ë¸Œë¦¬ë“œ ì™„ì„± âœ…
- âœ… ê²½ì œ ë°ì´í„°: `daily_stock_data` ì €ì¥ ì™„ë£Œ
- âœ… ê¸°ìˆ ì  ë¶„ì„: í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²• ì™„ë£Œ
- âœ… ë‰´ìŠ¤ ê°ì • ë¶„ì„: í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²• ì™„ë£Œ
- âœ… AI ì˜ˆì¸¡ ê²°ê³¼: í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²• ì™„ë£Œ (`predicted_stocks` + `stock_predictions`)
- âœ… AI ë¶„ì„ ê²°ê³¼: í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²• ì™„ë£Œ (`stock_analysis_results` + `stock_analysis`)

### Phase 2: í•µì‹¬ ê¸°ëŠ¥ ì „í™˜ (ìš°ì„ ìˆœìœ„ ë†’ìŒ)
1. **ì¢…ëª© ê´€ë¦¬** âœ… **ì™„ë£Œ**
   - âœ… `stock_ticker_mapping` â†’ `stocks` ì»¬ë ‰ì…˜ ì „í™˜ ì™„ë£Œ
   - ì˜í–¥: ëª¨ë“  ì„œë¹„ìŠ¤ì—ì„œ ì¢…ëª© ì •ë³´ ì¡°íšŒ

2. **AI ì˜ˆì¸¡ ë° ë¶„ì„** âœ… **ì™„ë£Œ**
   - âœ… `predicted_stocks` â†’ `stock_predictions` í•˜ì´ë¸Œë¦¬ë“œ ì €ì¥ ì™„ë£Œ
   - âœ… `stock_analysis_results` â†’ `stock_analysis` í•˜ì´ë¸Œë¦¬ë“œ ì €ì¥ ì™„ë£Œ
   - ì˜í–¥: ì˜ˆì¸¡ ê²°ê³¼ ì €ì¥/ì¡°íšŒ

3. **ê±°ë˜ëŸ‰ ë°ì´í„°**
   - `stock_daily_volume` â†’ `daily_stock_data.volumes` í•„ë“œ
   - ì˜í–¥: ì˜ˆì¸¡ ëª¨ë¸ í•™ìŠµ ë°ì´í„°

### Phase 3: ìë™ë§¤ë§¤ ì „í™˜ (ìš°ì„ ìˆœìœ„ ì¤‘ê°„)
1. **ìë™ë§¤ë§¤ ì„¤ì •**
   - `auto_trading_config` â†’ `trading_configs` ì»¬ë ‰ì…˜
   - ê°œì„ : ê°œì¸ë³„ ì„¤ì • ì§€ì› (user_id ì¶”ê°€)

2. **ìë™ë§¤ë§¤ ë¡œê·¸**
   - `auto_trading_logs` â†’ `trading_logs` ì»¬ë ‰ì…˜
   - ê°œì„ : ì‚¬ìš©ìë³„ ë¡œê·¸ ê´€ë¦¬ (user_id ì¶”ê°€)

### Phase 4: ê°œì¸í™” ê¸°ëŠ¥ (ìš°ì„ ìˆœìœ„ ë‚®ìŒ)
1. **ì‚¬ìš©ì ê´€ë¦¬**
   - `users` ì»¬ë ‰ì…˜ êµ¬í˜„
   - `user_stocks` ì»¬ë ‰ì…˜ êµ¬í˜„

---

## ğŸ“ ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1: í•˜ì´ë¸Œë¦¬ë“œ ì™„ì„± âœ…
- [x] ê²½ì œ ë°ì´í„° MongoDB ì €ì¥
- [x] ê¸°ìˆ ì  ë¶„ì„ í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²•
- [x] ë‰´ìŠ¤ ê°ì • ë¶„ì„ í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²•
- [x] AI ì˜ˆì¸¡ ê²°ê³¼ í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²• âœ… **ì™„ë£Œ**
- [x] AI ë¶„ì„ ê²°ê³¼ í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²• âœ… **ì™„ë£Œ**

### Phase 2: í•µì‹¬ ê¸°ëŠ¥ ì „í™˜
- [x] `stock_ticker_mapping` â†’ `stocks` ë§ˆì´ê·¸ë ˆì´ì…˜ âœ… **ì™„ë£Œ**
- [x] ì¢…ëª© ì¡°íšŒ ë¡œì§ MongoDBë¡œ ì „í™˜ âœ… **ì™„ë£Œ**
- [x] `predicted_stocks` â†’ `stock_predictions` í•˜ì´ë¸Œë¦¬ë“œ ì €ì¥ âœ… **ì™„ë£Œ**
- [x] ì˜ˆì¸¡ ê²°ê³¼ ì €ì¥ ë¡œì§ MongoDB ì¶”ê°€ âœ… **ì™„ë£Œ**
- [x] `stock_analysis_results` â†’ `stock_analysis` í•˜ì´ë¸Œë¦¬ë“œ ì €ì¥ âœ… **ì™„ë£Œ**
- [x] ë¶„ì„ ê²°ê³¼ ì €ì¥ ë¡œì§ MongoDB ì¶”ê°€ âœ… **ì™„ë£Œ**
- [ ] `stock_daily_volume` â†’ `daily_stock_data.volumes` ë§ˆì´ê·¸ë ˆì´ì…˜

### Phase 3: ìë™ë§¤ë§¤ ì „í™˜
- [ ] `auto_trading_config` â†’ `trading_configs` ë§ˆì´ê·¸ë ˆì´ì…˜
- [ ] ìë™ë§¤ë§¤ ì„¤ì • ë¡œì§ MongoDBë¡œ ì „í™˜
- [ ] `auto_trading_logs` â†’ `trading_logs` ë§ˆì´ê·¸ë ˆì´ì…˜
- [ ] ìë™ë§¤ë§¤ ë¡œê·¸ ì €ì¥/ì¡°íšŒ ë¡œì§ MongoDBë¡œ ì „í™˜

### Phase 4: ê°œì¸í™” ê¸°ëŠ¥
- [ ] `users` ì»¬ë ‰ì…˜ êµ¬í˜„
- [ ] `user_stocks` ì»¬ë ‰ì…˜ êµ¬í˜„
- [ ] ì‚¬ìš©ìë³„ ê´€ì‹¬ ì¢…ëª© ê´€ë¦¬ ê¸°ëŠ¥ êµ¬í˜„

---

## ğŸ”„ ì „í™˜ ì „ëµ

### 1. ì ì§„ì  ì „í™˜ (ê¶Œì¥)
- í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²• ìœ ì§€í•˜ë©´ì„œ ì ì§„ì ìœ¼ë¡œ MongoDBë¡œ ì „í™˜
- SupabaseëŠ” fallbackìœ¼ë¡œ ìœ ì§€
- ê° ê¸°ëŠ¥ë³„ë¡œ ë…ë¦½ì ìœ¼ë¡œ ì „í™˜ ê°€ëŠ¥

### 2. ì™„ì „ ì „í™˜
- ëª¨ë“  ê¸°ëŠ¥ì„ MongoDBë¡œ ì „í™˜
- Supabase ì˜ì¡´ì„± ì œê±°
- ë” ë¹ ë¥¸ ì „í™˜ ê°€ëŠ¥í•˜ì§€ë§Œ ë¦¬ìŠ¤í¬ ë†’ìŒ

### 3. ì„ íƒì  ì „í™˜
- í•µì‹¬ ê¸°ëŠ¥ë§Œ MongoDBë¡œ ì „í™˜
- ë¶€ê°€ ê¸°ëŠ¥ì€ Supabase ìœ ì§€
- ë¦¬ìŠ¤í¬ ìµœì†Œí™”

---

## ğŸ“Œ ì°¸ê³ ì‚¬í•­

1. **í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²•ì˜ ì¥ì **
   - ì ì§„ì  ì „í™˜ ê°€ëŠ¥
   - Supabase fallback ì œê³µ
   - ìš©ë„ë³„ ìµœì í™”ëœ êµ¬ì¡°

2. **ì „í™˜ ì‹œ ê³ ë ¤ì‚¬í•­**
   - ë°ì´í„° ì¼ê´€ì„± ìœ ì§€
   - ê¸°ì¡´ API í˜¸í™˜ì„± ìœ ì§€
   - ì„±ëŠ¥ ìµœì í™”

3. **ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸**
   - `scripts/setup_mongodb_schema.py`: ìŠ¤í‚¤ë§ˆ ë° ì¸ë±ìŠ¤ ìƒì„±
   - `scripts/create_mongodb_collections.py`: ì»¬ë ‰ì…˜ ìƒì„± ë° ì´ˆê¸° ë°ì´í„° ì„¸íŒ…
   - ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ í•„ìš” (ì‘ì„± ì˜ˆì •)

