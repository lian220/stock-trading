# MongoDB ìš©ì–´ ì •ë¦¬

## ğŸ“‹ ìš©ì–´ í†µì¼ ê·œì¹™

### 1. ë‰´ìŠ¤ ê°ì • ë¶„ì„ (News Sentiment Analysis)

#### í•œê¸€ ìš©ì–´
- **ì •ì‹ ëª…ì¹­**: "ë‰´ìŠ¤ ê°ì • ë¶„ì„"
- **ê°„ë‹¨ ëª…ì¹­**: "ê°ì • ë¶„ì„" (ë¬¸ë§¥ìƒ ëª…í™•í•  ë•Œ)
- **ì‚¬ìš© ì˜ˆì‹œ**:
  - âœ… "ë‰´ìŠ¤ ê°ì • ë¶„ì„ ë°ì´í„°ë¥¼ MongoDBì— ì €ì¥"
  - âœ… "ê°ì • ë¶„ì„ ì ìˆ˜ê°€ 0.15 ì´ìƒì¸ ì¢…ëª©"
  - âŒ "ë‰´ìŠ¤ ë¶„ì„" (ëª¨í˜¸í•¨)

#### ì˜ì–´ ìš©ì–´
- **í•¨ìˆ˜ëª…**: `fetch_and_store_sentiment_for_recommendations()`
- **API ì—”ë“œí¬ì¸íŠ¸**: `/analyze-news-sentiment`
- **ë³€ìˆ˜ëª…**: `sentiment`, `sentiment_score`, `sentiment_data`, `sentiment_map`

#### ë°ì´í„°ë² ì´ìŠ¤
- **Supabase í…Œì´ë¸”**: `ticker_sentiment_analysis`
- **MongoDB ì»¬ë ‰ì…˜**: `sentiment_analysis`
- **MongoDB í•„ë“œ**: `daily_stock_data.sentiment` (í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²•)

#### í•„ë“œëª…
- `average_sentiment_score`: í‰ê·  ê°ì • ì ìˆ˜ (-1 ~ 1)
- `article_count`: ë¶„ì„í•œ ê¸°ì‚¬ ìˆ˜
- `calculation_date`: ê³„ì‚° ì¼ì‹œ
- `sentiment_score`: ê°ì • ì ìˆ˜ (ë³„ì¹­, `average_sentiment_score`ì™€ ë™ì¼)

---

### 2. ê¸°ìˆ ì  ë¶„ì„ (Technical Analysis)

#### í•œê¸€ ìš©ì–´
- **ì •ì‹ ëª…ì¹­**: "ê¸°ìˆ ì  ì§€í‘œ ë¶„ì„" ë˜ëŠ” "ê¸°ìˆ ì  ë¶„ì„"
- **ê°„ë‹¨ ëª…ì¹­**: "ê¸°ìˆ ì  ì§€í‘œ" (ì§€í‘œ ìì²´ë¥¼ ê°€ë¦¬í‚¬ ë•Œ)
- **ì‚¬ìš© ì˜ˆì‹œ**:
  - âœ… "ê¸°ìˆ ì  ì§€í‘œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¶”ì²œ ë°ì´í„° ìƒì„±"
  - âœ… "ê¸°ìˆ ì  ë¶„ì„ ê²°ê³¼ë¥¼ MongoDBì— ì €ì¥"
  - âœ… "ê¸°ìˆ ì  ì§€í‘œ (SMA20, SMA50, RSI, MACD)"

#### ì˜ì–´ ìš©ì–´
- **í•¨ìˆ˜ëª…**: `generate_technical_recommendations()`
- **API ì—”ë“œí¬ì¸íŠ¸**: `/generate-technical-recommendations`
- **ë³€ìˆ˜ëª…**: `technical_indicators`, `tech_data`, `tech_map`

#### ë°ì´í„°ë² ì´ìŠ¤
- **Supabase í…Œì´ë¸”**: `stock_recommendations`
- **MongoDB ì»¬ë ‰ì…˜**: `stock_recommendations`
- **MongoDB í•„ë“œ**: `daily_stock_data.recommendations` (í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²•)

#### í•„ë“œëª…
- `technical_indicators`: ê¸°ìˆ ì  ì§€í‘œ ê°ì²´
  - `sma20`: 20ì¼ ë‹¨ìˆœ ì´ë™í‰ê· 
  - `sma50`: 50ì¼ ë‹¨ìˆœ ì´ë™í‰ê· 
  - `golden_cross`: ê³¨ë“  í¬ë¡œìŠ¤ ì—¬ë¶€
  - `rsi`: RSI ì§€í‘œ
  - `macd`: MACD ì§€í‘œ
  - `signal`: Signal ë¼ì¸
  - `macd_buy_signal`: MACD ë§¤ìˆ˜ ì‹ í˜¸ ì—¬ë¶€
- `is_recommended`: ì¶”ì²œ ì—¬ë¶€
- `recommendation_score`: ì¶”ì²œ ì ìˆ˜

---

### 3. AI ì˜ˆì¸¡ ë° ë¶„ì„ ìš©ì–´

| ìš©ì–´ | Supabase í…Œì´ë¸” | MongoDB ì»¬ë ‰ì…˜ | MongoDB í•„ë“œ |
|------|----------------|---------------|--------------|
| **AI ì˜ˆì¸¡ ê²°ê³¼** | `predicted_stocks` | `stock_predictions` | `daily_stock_data.predictions` |
| **AI ë¶„ì„ ê²°ê³¼** | `stock_analysis_results` | `stock_analysis` | `daily_stock_data.analysis` |

**í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²•:**
- Supabase: ë‚ ì§œë³„/ì¢…ëª©ë³„ í•œ í–‰ì— ëª¨ë“  ë°ì´í„° (Wide format)
- MongoDB ì»¬ë ‰ì…˜: ì¢…ëª©ë³„ ì‹œê³„ì—´ ì¡°íšŒìš© (Long format)
- MongoDB í•„ë“œ: ë‚ ì§œë³„ í†µí•© ì¡°íšŒìš© (`daily_stock_data` ë‚´ë¶€)

---

### 4. í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²• ìš©ì–´

#### ì»¬ë ‰ì…˜ êµ¬ì¡°
- **ë‚ ì§œë³„ í†µí•© ì¡°íšŒ**: `daily_stock_data`
  - `recommendations`: ê¸°ìˆ ì  ë¶„ì„ ì¶”ì²œ ì •ë³´
  - `sentiment`: ë‰´ìŠ¤ ê°ì • ë¶„ì„ ì •ë³´
  - `predictions`: AI ì˜ˆì¸¡ ê²°ê³¼ ì •ë³´
  - `analysis`: AI ë¶„ì„ ê²°ê³¼ ì •ë³´
- **ì¢…ëª©ë³„ ì‹œê³„ì—´ ì¡°íšŒ**:
  - `stock_recommendations`: ê¸°ìˆ ì  ë¶„ì„ ì‹œê³„ì—´
  - `sentiment_analysis`: ë‰´ìŠ¤ ê°ì • ë¶„ì„ ì‹œê³„ì—´
  - `stock_predictions`: AI ì˜ˆì¸¡ ê²°ê³¼ ì‹œê³„ì—´
  - `stock_analysis`: AI ë¶„ì„ ê²°ê³¼ ì‹œê³„ì—´

#### í•„ë“œëª… ê·œì¹™
- `daily_stock_data.recommendations`: ê¸°ìˆ ì  ë¶„ì„
- `daily_stock_data.sentiment`: ë‰´ìŠ¤ ê°ì • ë¶„ì„
- `daily_stock_data.predictions`: AI ì˜ˆì¸¡ ê²°ê³¼
- `daily_stock_data.analysis`: AI ë¶„ì„ ê²°ê³¼
- ëª¨ë“  í•„ë“œëŠ” ë™ì¼í•œ êµ¬ì¡°ë¡œ ì €ì¥ (í‹°ì»¤ë¥¼ í‚¤ë¡œ í•˜ëŠ” ê°ì²´):
  ```javascript
  {
    "AAPL": {
      // í•„ë“œë³„ ìƒì„¸ ì •ë³´
    },
    "MSFT": {
      // í•„ë“œë³„ ìƒì„¸ ì •ë³´
    }
  }
  ```

---

### 4. í•¨ìˆ˜ëª… ë° ë³€ìˆ˜ëª… ê·œì¹™

#### í•¨ìˆ˜ëª…
- **ê¸°ìˆ ì  ë¶„ì„**: `generate_technical_recommendations()`
- **ë‰´ìŠ¤ ê°ì • ë¶„ì„**: `fetch_and_store_sentiment_for_recommendations()`
- **í†µí•© ì¡°íšŒ**: `get_combined_recommendations_with_technical_and_sentiment()`

#### ë³€ìˆ˜ëª…
- **ê¸°ìˆ ì  ë¶„ì„**: `tech_*`, `technical_*`, `recommendations_*`
- **ë‰´ìŠ¤ ê°ì • ë¶„ì„**: `sentiment_*`, `sentiment_score`, `sentiment_data`
- **í†µí•©**: `combined_*`, `final_*`

---

### 5. API ì—”ë“œí¬ì¸íŠ¸ ëª…ëª… ê·œì¹™

#### ê¸°ìˆ ì  ë¶„ì„
- `POST /recommended-stocks/generate-technical-recommendations`
- `GET /recommended-stocks/with-technical-and-sentiment`

#### ë‰´ìŠ¤ ê°ì • ë¶„ì„
- `POST /recommended-stocks/analyze-news-sentiment`
- `GET /recommended-stocks/with-sentiment`

#### MongoDB ì¡°íšŒ
- `GET /stocks/mongodb/daily/{date}` - ë‚ ì§œë³„ í†µí•© ì¡°íšŒ
- `GET /stocks/mongodb/stocks/{ticker}/recommendations` - ì¢…ëª©ë³„ ê¸°ìˆ ì  ë¶„ì„ ì´ë ¥
- `GET /stocks/mongodb/stocks/{ticker}/sentiment` - ì¢…ëª©ë³„ ê°ì • ë¶„ì„ ì´ë ¥ (ì‹ ê·œ ì¶”ê°€ ì˜ˆì •)

---

### 6. ë¡œê·¸ ë©”ì‹œì§€ ê·œì¹™

#### ê¸°ìˆ ì  ë¶„ì„
- âœ… "ê¸°ìˆ ì  ì§€í‘œ ë¶„ì„ ì™„ë£Œ"
- âœ… "MongoDB stock_recommendations ì €ì¥ ì„±ê³µ"
- âœ… "MongoDB daily_stock_data.recommendations ì—…ë°ì´íŠ¸ ì„±ê³µ"

#### ë‰´ìŠ¤ ê°ì • ë¶„ì„
- âœ… "ë‰´ìŠ¤ ê°ì • ë¶„ì„ ì™„ë£Œ"
- âœ… "MongoDB sentiment_analysis ì €ì¥ ì„±ê³µ"
- âœ… "MongoDB daily_stock_data.sentiment ì—…ë°ì´íŠ¸ ì„±ê³µ" (ì‹ ê·œ ì¶”ê°€ ì˜ˆì •)

---

### 7. ë¬¸ì„œ ì£¼ì„ ê·œì¹™

#### í•¨ìˆ˜ docstring
```python
def fetch_and_store_sentiment_for_recommendations(self):
    """
    ì¶”ì²œ ì£¼ì‹ê³¼ ë³´ìœ  ì¤‘ì¸ ì£¼ì‹ì— ëŒ€í•´ ë‰´ìŠ¤ ê°ì • ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³ , 
    Supabaseì™€ MongoDBì— ì €ì¥í•˜ë©°, ê°ì • ë¶„ì„ê³¼ ì¶”ì²œ ì •ë³´ë¥¼ í†µí•©í•˜ì—¬ ë°˜í™˜í•©ë‹ˆë‹¤.
    
    MongoDB í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²•:
    - sentiment_analysis ì»¬ë ‰ì…˜: ì¢…ëª©ë³„ ì‹œê³„ì—´ ì¡°íšŒìš©
    - daily_stock_data.sentiment í•„ë“œ: ë‚ ì§œë³„ í†µí•© ì¡°íšŒìš©
    """
```

---

### 8. ìš©ì–´ ëŒ€ì‘í‘œ

| í•œê¸€ (ì •ì‹) | í•œê¸€ (ê°„ë‹¨) | ì˜ì–´ | Supabase í…Œì´ë¸” | MongoDB ì»¬ë ‰ì…˜ | MongoDB í•„ë“œ |
|------------|------------|------|----------------|---------------|-------------|
| ë‰´ìŠ¤ ê°ì • ë¶„ì„ | ê°ì • ë¶„ì„ | Sentiment Analysis | `ticker_sentiment_analysis` | `sentiment_analysis` | `daily_stock_data.sentiment` |
| ê¸°ìˆ ì  ì§€í‘œ ë¶„ì„ | ê¸°ìˆ ì  ë¶„ì„ | Technical Analysis | `stock_recommendations` | `stock_recommendations` | `daily_stock_data.recommendations` |
| ì¶”ì²œ | ì¶”ì²œ | Recommendation | `stock_recommendations` | `stock_recommendations` | `daily_stock_data.recommendations` |

---

### 9. ì£¼ì˜ì‚¬í•­

1. **"ë‰´ìŠ¤ ê°ì • ë¶„ì„" vs "ê°ì • ë¶„ì„"**
   - ê³µì‹ ë¬¸ì„œë‚˜ API ì„¤ëª…: "ë‰´ìŠ¤ ê°ì • ë¶„ì„" ì‚¬ìš©
   - ì½”ë“œ ì£¼ì„ì´ë‚˜ ë³€ìˆ˜ëª…: "ê°ì • ë¶„ì„" ì‚¬ìš© ê°€ëŠ¥ (ë¬¸ë§¥ìƒ ëª…í™•í•  ë•Œ)

2. **"ê¸°ìˆ ì  ì§€í‘œ" vs "ê¸°ìˆ ì  ë¶„ì„"**
   - ì§€í‘œ ìì²´ë¥¼ ê°€ë¦¬í‚¬ ë•Œ: "ê¸°ìˆ ì  ì§€í‘œ" (SMA20, RSI ë“±)
   - ë¶„ì„ ê³¼ì •ì„ ê°€ë¦¬í‚¬ ë•Œ: "ê¸°ìˆ ì  ë¶„ì„"

3. **MongoDB í•„ë“œëª… ì¼ê´€ì„±**
   - `daily_stock_data.recommendations`: ê¸°ìˆ ì  ë¶„ì„
   - `daily_stock_data.sentiment`: ë‰´ìŠ¤ ê°ì • ë¶„ì„
   - ë‘ í•„ë“œëŠ” ë™ì¼í•œ êµ¬ì¡° (tickerë¥¼ í‚¤ë¡œ í•˜ëŠ” ê°ì²´)

4. **ì»¬ë ‰ì…˜ëª… vs í•„ë“œëª…**
   - ì»¬ë ‰ì…˜: `sentiment_analysis` (ì¢…ëª©ë³„ ì‹œê³„ì—´)
   - í•„ë“œ: `daily_stock_data.sentiment` (ë‚ ì§œë³„ í†µí•©)

---

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

ìƒˆë¡œìš´ ì½”ë“œ ì‘ì„± ì‹œ ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

- [ ] í•œê¸€ ìš©ì–´ê°€ ì •ì‹ ëª…ì¹­ì„ ì‚¬ìš©í•˜ëŠ”ê°€?
- [ ] ì˜ì–´ ë³€ìˆ˜ëª…ì´ ì¼ê´€ì„± ìˆê²Œ ì‚¬ìš©ë˜ëŠ”ê°€?
- [ ] MongoDB í•„ë“œëª…ì´ `recommendations`ì™€ `sentiment`ë¡œ ì¼ê´€ì„± ìˆê²Œ ì‚¬ìš©ë˜ëŠ”ê°€?
- [ ] ë¡œê·¸ ë©”ì‹œì§€ê°€ ëª…í™•í•œê°€?
- [ ] í•¨ìˆ˜ docstringì— í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²• ì„¤ëª…ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ê°€?

