# í†µí•© ì¶”ì²œ ì‹œìŠ¤í…œ ê°€ì´ë“œ

## ğŸ“Š ê°œìš”

`get_combined_recommendations_with_technical_and_sentiment()` í•¨ìˆ˜ëŠ” **3ê°€ì§€ ë¶„ì„ ë°©ë²•**ì„ í†µí•©í•˜ì—¬ ìµœì¢… ë§¤ìˆ˜ ì¶”ì²œ ì¢…ëª©ì„ ì„ ì •í•˜ëŠ” í•µì‹¬ í•¨ìˆ˜ì…ë‹ˆë‹¤.

## ğŸ¯ 3ê°€ì§€ ë¶„ì„ ë°©ë²•

### 1. ğŸ“ˆ ê¸°ìˆ ì  ì§€í‘œ ë¶„ì„ (Technical Analysis)
**ë°ì´í„° ì†ŒìŠ¤**: `stock_recommendations` í…Œì´ë¸”

| ì§€í‘œ | ì„¤ëª… | ë§¤ìˆ˜ ì‹ í˜¸ |
|-----|------|----------|
| **ê³¨ë“  í¬ë¡œìŠ¤** | SMA20 > SMA50 | âœ… True |
| **RSI** | Relative Strength Index | âœ… < 50 (ê³¼ë§¤ë„ êµ¬ê°„) |
| **MACD** | MACD > Signal | âœ… True |

### 2. ğŸ¤– AI ì£¼ê°€ ì˜ˆì¸¡ (AI Prediction)
**ë°ì´í„° ì†ŒìŠ¤**: `stock_analysis_results` í…Œì´ë¸”

| ì§€í‘œ | ì„¤ëª… | ë§¤ìˆ˜ ê¸°ì¤€ |
|-----|------|----------|
| **Accuracy** | ì˜ˆì¸¡ ì •í™•ë„ | â‰¥ 80% |
| **Rise Probability** | 14ì¼ í›„ ìƒìŠ¹ í™•ë¥  | â‰¥ 3% |
| **Recommendation** | AI ì¶”ì²œ ë“±ê¸‰ | BUY ë˜ëŠ” STRONG BUY |

### 3. ğŸ“° ë‰´ìŠ¤ ê°ì • ë¶„ì„ (Sentiment Analysis)
**ë°ì´í„° ì†ŒìŠ¤**: `ticker_sentiment_analysis` í…Œì´ë¸”

| ì§€í‘œ | ì„¤ëª… | ë§¤ìˆ˜ ê¸°ì¤€ |
|-----|------|----------|
| **Sentiment Score** | ë‰´ìŠ¤ ê°ì • ì ìˆ˜ | â‰¥ 0.15 (ê¸ì •ì ) |
| **Article Count** | ë¶„ì„í•œ ê¸°ì‚¬ ìˆ˜ | â‰¥ 5ê°œ (ì‹ ë¢°ë„) |

## ğŸ” ìµœì¢… ë§¤ìˆ˜ ì¶”ì²œ ì¡°ê±´

### ì¡°ê±´ 1: ê¸ì •ì  ê°ì • + ê¸°ìˆ ì  ì‹ í˜¸
```
ê°ì • ì ìˆ˜ â‰¥ 0.15 AND ê¸°ìˆ ì  ì¡°ê±´ 2ê°œ ì´ìƒ ë§Œì¡±
```
- ê³¨ë“  í¬ë¡œìŠ¤, RSI < 50, MACD ë§¤ìˆ˜ ì‹ í˜¸ ì¤‘ **2ê°œ ì´ìƒ**
- ë‰´ìŠ¤ ê°ì •ì´ ê¸ì •ì ì´ë©´ ê¸°ìˆ ì  ì‹ í˜¸ ê¸°ì¤€ ì™„í™”

### ì¡°ê±´ 2: ê°•ë ¥í•œ ê¸°ìˆ ì  ì‹ í˜¸
```
ê¸°ìˆ ì  ì¡°ê±´ 3ê°œ ëª¨ë‘ ë§Œì¡±
```
- ê³¨ë“  í¬ë¡œìŠ¤, RSI < 50, MACD ë§¤ìˆ˜ ì‹ í˜¸ **3ê°œ ëª¨ë‘**
- ê°ì • ì ìˆ˜ê°€ ë‚®ì•„ë„ ê¸°ìˆ ì ìœ¼ë¡œ ê°•ë ¥í•œ ë§¤ìˆ˜ ì‹ í˜¸

## ğŸ“Š ì¢…í•© ì ìˆ˜ ê³„ì‚° (Composite Score)

### ì ìˆ˜ ì‚°ì • ê³µì‹
```python
composite_score = (
    0.3 Ã— rise_probability +           # 30%: AI ì˜ˆì¸¡ ìƒìŠ¹ë¥ 
    0.4 Ã— tech_conditions_count +      # 40%: ê¸°ìˆ ì  ì§€í‘œ ì ìˆ˜
    0.3 Ã— sentiment_score              # 30%: ê°ì • ë¶„ì„ ì ìˆ˜
)
```

### ê¸°ìˆ ì  ì§€í‘œ ì ìˆ˜ ê³„ì‚°
```python
tech_conditions_count = (
    1.5 Ã— golden_cross +       # ê³¨ë“  í¬ë¡œìŠ¤ (1.5ì )
    1.0 Ã— (rsi < 50) +        # RSI ê³¼ë§¤ë„ (1.0ì )
    1.0 Ã— macd_buy_signal     # MACD ë§¤ìˆ˜ (1.0ì )
)
# ìµœëŒ€ 3.5ì 
```

## ğŸ”„ ì‹¤í–‰ íë¦„

```
1. ê¸°ìˆ ì  ì§€í‘œ ë°ì´í„° ì¡°íšŒ (stock_recommendations)
   â†“
2. ì¡°ê±´ í•„í„°ë§ (ê³¨ë“ í¬ë¡œìŠ¤ OR RSI<50 OR MACDë§¤ìˆ˜ì‹ í˜¸)
   â†“
3. AI ì£¼ê°€ ì˜ˆì¸¡ ë°ì´í„° ì¡°íšŒ (stock_analysis_results)
   â†“
4. ê°ì • ë¶„ì„ ë°ì´í„° ì¡°íšŒ (ticker_sentiment_analysis)
   â†“
5. ë°ì´í„° ë§¤í•‘ ë° í†µí•©
   â†“
6. ìµœì¢… ë§¤ìˆ˜ ì¡°ê±´ í•„í„°ë§
   â†“
7. ì¢…í•© ì ìˆ˜ ê³„ì‚° ë° ì •ë ¬
   â†“
8. Slack ì•Œë¦¼ ë°œì†¡
   â†“
9. ê²°ê³¼ ë°˜í™˜
```

## ğŸ“‹ ë°˜í™˜ ë°ì´í„° êµ¬ì¡°

### ì‘ë‹µ í˜•ì‹
```json
{
  "message": "5ê°œì˜ ë§¤ìˆ˜ ì¶”ì²œ ì£¼ì‹ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤",
  "results": [
    {
      "ticker": "NVDA",
      "stock_name": "ì—”ë¹„ë””ì•„",
      "composite_score": 8.75,
      
      // AI ì˜ˆì¸¡ ì •ë³´
      "accuracy": 92.5,
      "rise_probability": 5.8,
      "last_price": 480.50,
      "predicted_price": 508.36,
      "recommendation": "STRONG BUY",
      "analysis": "ì—”ë¹„ë””ì•„ is expected to rise by about 5.80%. Consider buying or holding.",
      
      // ê°ì • ë¶„ì„ ì •ë³´
      "sentiment_score": 0.25,
      "article_count": 15,
      "sentiment_date": "2024-12-04 10:30:00",
      
      // ê¸°ìˆ ì  ì§€í‘œ ì •ë³´
      "technical_date": "2024-12-04",
      "sma20": 485.30,
      "sma50": 470.20,
      "golden_cross": true,
      "rsi": 45.5,
      "macd": 3.2,
      "signal": 2.8,
      "macd_buy_signal": true,
      "technical_recommended": true
    }
  ]
}
```

## ğŸ¯ í™œìš© ë°©ë²•

### 1. API ì—”ë“œí¬ì¸íŠ¸ì—ì„œ í˜¸ì¶œ
```python
# app/api/routes/stock_recommendations.py

@router.get("/combined-recommendations")
async def get_combined_recommendations():
    service = StockRecommendationService()
    return service.get_combined_recommendations_with_technical_and_sentiment()
```

### 2. ìŠ¤ì¼€ì¤„ëŸ¬ì—ì„œ ìë™ ì‹¤í–‰
```python
# app/utils/scheduler.py

@scheduler.scheduled_job('cron', hour=20, minute=0, timezone='US/Eastern')
def analyze_combined_recommendations():
    service = StockRecommendationService()
    result = service.get_combined_recommendations_with_technical_and_sentiment()
    # ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìë™ ë§¤ìˆ˜ ì‹¤í–‰
```

### 3. ì§ì ‘ í˜¸ì¶œ
```python
from app.services.stock_recommendation_service import StockRecommendationService

service = StockRecommendationService()
result = service.get_combined_recommendations_with_technical_and_sentiment()

# ìƒìœ„ 5ê°œ ì¢…ëª© ì¶œë ¥
for stock in result['results'][:5]:
    print(f"{stock['stock_name']}: {stock['composite_score']:.2f}ì ")
    print(f"  ìƒìŠ¹í™•ë¥ : {stock['rise_probability']:.1f}%")
    print(f"  ê°ì •ì ìˆ˜: {stock['sentiment_score']:.2f}")
    print(f"  ê¸°ìˆ ì‹ í˜¸: {stock['golden_cross']}, RSI={stock['rsi']:.1f}, MACD={stock['macd_buy_signal']}")
```

## ğŸ“Š ì‹¤ì „ ì˜ˆì‹œ

### ì˜ˆì‹œ 1: ì—”ë¹„ë””ì•„ (NVDA)
```
âœ… ë§¤ìˆ˜ ì¶”ì²œ (ì¢…í•© ì ìˆ˜: 8.75)

AI ì˜ˆì¸¡:
- ìƒìŠ¹ í™•ë¥ : 5.8%
- ì •í™•ë„: 92.5%
- ì¶”ì²œ: STRONG BUY

ê¸°ìˆ ì  ì§€í‘œ:
- ê³¨ë“  í¬ë¡œìŠ¤: âœ…
- RSI: 45.5 (ê³¼ë§¤ë„)
- MACD ë§¤ìˆ˜ ì‹ í˜¸: âœ…

ê°ì • ë¶„ì„:
- ê°ì • ì ìˆ˜: 0.25 (ê¸ì •ì )
- ê¸°ì‚¬ ìˆ˜: 15ê°œ

â†’ ì¡°ê±´ 1 ë§Œì¡±: ê¸ì •ì  ê°ì • + 3ê°œ ê¸°ìˆ  ì‹ í˜¸
```

### ì˜ˆì‹œ 2: í…ŒìŠ¬ë¼ (TSLA)
```
âš ï¸ ë§¤ìˆ˜ ê³ ë ¤ (ì¢…í•© ì ìˆ˜: 6.20)

AI ì˜ˆì¸¡:
- ìƒìŠ¹ í™•ë¥ : 3.2%
- ì •í™•ë„: 85.0%
- ì¶”ì²œ: BUY

ê¸°ìˆ ì  ì§€í‘œ:
- ê³¨ë“  í¬ë¡œìŠ¤: âœ…
- RSI: 52.3 (ì¤‘ë¦½)
- MACD ë§¤ìˆ˜ ì‹ í˜¸: âœ…

ê°ì • ë¶„ì„:
- ê°ì • ì ìˆ˜: 0.10 (ì•½ê°„ ê¸ì •)
- ê¸°ì‚¬ ìˆ˜: 8ê°œ

â†’ ì¡°ê±´ 1 ë§Œì¡±: 2ê°œ ê¸°ìˆ  ì‹ í˜¸ + ì•½í•œ ê¸ì • ê°ì •
```

## ğŸ”” Slack ì•Œë¦¼

### í†µí•© ë¶„ì„ ì™„ë£Œ ì•Œë¦¼
```
ğŸ¯ í†µí•© ì£¼ì‹ ë¶„ì„ ì™„ë£Œ!

ğŸ“Š ë¶„ì„ í†µê³„:
â€¢ ì „ì²´ ë¶„ì„: 34ê°œ ì¢…ëª©
â€¢ ìµœì¢… ì¶”ì²œ: 5ê°œ ì¢…ëª©
â€¢ í‰ê·  ì¢…í•© ì ìˆ˜: 7.85
â€¢ í‰ê·  ìƒìŠ¹ í™•ë¥ : 4.2%

ğŸ“ˆ ë¶„ì„ ê²°ê³¼:
â€¢ ê¸°ìˆ ì  ì‹ í˜¸: 12ê°œ
â€¢ ê¸ì • ê°ì •: 8ê°œ
â€¢ AI ì˜ˆì¸¡ ë§¤ìˆ˜: 15ê°œ

ğŸ” ìƒìœ„ 5ê°œ ì¶”ì²œ:
1. NVDA (ì—”ë¹„ë””ì•„) - 8.75ì 
   ìƒìŠ¹ë¥ : 5.8% | ê°ì •: 0.25 | ê³¨ë“ í¬ë¡œìŠ¤ âœ…
2. AAPL (ì• í”Œ) - 8.20ì 
   ìƒìŠ¹ë¥ : 4.5% | ê°ì •: 0.18 | RSI: 42.3
3. ...
```

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. ë°ì´í„° ìµœì‹ ì„±
- ê° í…Œì´ë¸”ì˜ ë°ì´í„°ê°€ ìµœì‹ ì¸ì§€ í™•ì¸ í•„ìš”
- ê¸°ìˆ ì  ì§€í‘œëŠ” ë§¤ì¼ ê°±ì‹  ê¶Œì¥
- ê°ì • ë¶„ì„ì€ 3ì¼ë§ˆë‹¤ ê°±ì‹  ê¶Œì¥

### 2. ë§¤ìˆ˜ ì¡°ê±´ ê²€ì¦
```python
# ì¡°ê±´ 1: ê°ì • ê¸ì • + ê¸°ìˆ  2ê°œ ì´ìƒ
if sentiment_score >= 0.15 and tech_conditions >= 2:
    âœ… ë§¤ìˆ˜ ì¶”ì²œ

# ì¡°ê±´ 2: ê¸°ìˆ  3ê°œ ëª¨ë‘
if tech_conditions == 3:
    âœ… ë§¤ìˆ˜ ì¶”ì²œ (ê°ì • ë¬´ê´€)
```

### 3. ë¦¬ìŠ¤í¬ ê´€ë¦¬
- ì¢…í•© ì ìˆ˜ê°€ ë†’ì•„ë„ ì†ì ˆë§¤ ì„¤ì • í•„ìˆ˜
- í•œ ì¢…ëª©ì— ì „ì²´ ìê¸ˆì˜ 10% ì´ìƒ íˆ¬ì ì§€ì–‘
- ì‹œì¥ ë³€ë™ì„±ì´ í° ì‹œê¸°ì—ëŠ” ë§¤ìˆ˜ ë¹„ì¤‘ ì¶•ì†Œ

## ğŸ”— ì—°ê´€ í•¨ìˆ˜

### ê´€ë ¨ ì„œë¹„ìŠ¤ í•¨ìˆ˜ë“¤
```python
# ê¸°ìˆ ì  ì§€í‘œë§Œ ì‚¬ìš©
service.generate_technical_recommendations()

# AI ì˜ˆì¸¡ë§Œ ì‚¬ìš©
service.get_stock_recommendations()

# ê°ì • ë¶„ì„ í¬í•¨ (2ê°€ì§€ í†µí•©)
service.get_recommendations_with_sentiment()

# í†µí•© ì¶”ì²œ (3ê°€ì§€ í†µí•©) â­
service.get_combined_recommendations_with_technical_and_sentiment()

# ê°ì • ë¶„ì„ ë°ì´í„° ìˆ˜ì§‘ ë° ì €ì¥
service.fetch_and_store_sentiment_for_recommendations()

# ë§¤ë„ ëŒ€ìƒ ì¢…ëª© ë¶„ì„
service.get_stocks_to_sell()
```

## ğŸ“š ì°¸ê³  ë¬¸ì„œ

- `ë§¤ìˆ˜_ë™ì‘_ê°€ì´ë“œ.md`: ìë™ ë§¤ë§¤ ì‹œìŠ¤í…œ ì „ì²´ íë¦„
- `ìŠ¤ì¼€ì¤„ëŸ¬_ê°€ì´ë“œ.md`: ìŠ¤ì¼€ì¤„ëŸ¬ ì‹¤í–‰ ê°€ì´ë“œ
- `ì£¼ì‹ì˜ˆì¸¡ëª¨ë¸_ê°€ì´ë“œ.md`: AI ì˜ˆì¸¡ ëª¨ë¸ ì„¤ëª…
- `documents/queries/README.md`: SQL ì¿¼ë¦¬ ì˜ˆì‹œ

## ğŸš€ ë¹ ë¥¸ í…ŒìŠ¤íŠ¸

```python
# 1. í†µí•© ì¶”ì²œ ì¡°íšŒ
from app.services.stock_recommendation_service import StockRecommendationService

service = StockRecommendationService()
result = service.get_combined_recommendations_with_technical_and_sentiment()

print(f"ì´ {len(result['results'])}ê°œ ì¶”ì²œ ì¢…ëª©")
for stock in result['results'][:3]:
    print(f"- {stock['stock_name']}: {stock['composite_score']:.2f}ì ")
```

## ğŸ’¡ ìµœì í™” íŒ

### 1. ì¡°ê±´ ì™„í™” (ë” ë§ì€ ì¶”ì²œ)
```python
# í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì¡°ê±´ ìˆ˜ì •
if sentiment_score >= 0.10:  # 0.15 â†’ 0.10
    if sum(tech_conditions) >= 1:  # 2 â†’ 1
        final_results.append(item)
```

### 2. ì¡°ê±´ ê°•í™” (ë” ì‹ ë¢°ë„ ë†’ì€ ì¶”ì²œ)
```python
# ë” ì—„ê²©í•œ ì¡°ê±´
if sentiment_score >= 0.20:  # 0.15 â†’ 0.20
    if sum(tech_conditions) >= 3:  # 2 â†’ 3 (ëª¨ë“  ì¡°ê±´)
        final_results.append(item)
```

### 3. ì¢…í•© ì ìˆ˜ ê°€ì¤‘ì¹˜ ì¡°ì •
```python
# AI ì˜ˆì¸¡ ì¤‘ì‹¬
composite_score = (
    0.5 Ã— rise_probability +   # 30% â†’ 50%
    0.3 Ã— tech_conditions +    # 40% â†’ 30%
    0.2 Ã— sentiment_score      # 30% â†’ 20%
)

# ê¸°ìˆ ì  ì§€í‘œ ì¤‘ì‹¬
composite_score = (
    0.2 Ã— rise_probability +   # 30% â†’ 20%
    0.6 Ã— tech_conditions +    # 40% â†’ 60%
    0.2 Ã— sentiment_score      # 30% â†’ 20%
)
```

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2024-12-04

