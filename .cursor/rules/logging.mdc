---
description: 로깅 규칙 및 로그 작성 가이드
globs:
  - "app/**/*.py"
  - "scripts/**/*.py"
alwaysApply: false
---

# 로깅 규칙

## 로깅 설정

### 1. 로거 생성

각 모듈에서 `__name__`을 사용하여 로거를 생성합니다:

```python
import logging

logger = logging.getLogger(__name__)
```

### 2. 로그 레벨

- **DEBUG**: 상세한 디버깅 정보
- **INFO**: 일반적인 정보성 메시지
- **WARNING**: 경고 메시지 (문제가 될 수 있지만 계속 진행 가능)
- **ERROR**: 오류 메시지 (작업 실패)
- **CRITICAL**: 심각한 오류 (시스템 중단 가능)

### 3. 로그 포맷

프로젝트 표준 로그 포맷:

```python
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.StreamHandler(),
        logging.FileHandler('app.log')
    ]
)
```

## 로깅 사용 규칙

### 1. 정보성 로그 (INFO)

중요한 작업 시작/완료 시:

```python
logger.info(f"주식 데이터 수집 시작: {ticker}")
# 작업 수행
logger.info(f"주식 데이터 수집 완료: {ticker}")
```

### 2. 오류 로그 (ERROR)

예외 발생 시:

```python
try:
    result = await repository.find_by_ticker(ticker)
except Exception as e:
    logger.error(f"주식 조회 중 오류 발생: {ticker}, {str(e)}", exc_info=True)
    raise
```

### 3. 경고 로그 (WARNING)

문제가 될 수 있지만 계속 진행 가능한 경우:

```python
if not api_key:
    logger.warning("API 키가 설정되지 않았습니다. 일부 기능이 제한될 수 있습니다.")
```

### 4. 디버그 로그 (DEBUG)

상세한 디버깅 정보:

```python
logger.debug(f"API 요청 파라미터: {params}")
logger.debug(f"API 응답: {response}")
```

### 5. 로그 메시지 형식

명확하고 구조화된 로그 메시지:

```python
# ✅ 올바른 방법
logger.info(f"주식 매수 주문 실행: ticker={ticker}, quantity={quantity}, price={price}")

# ❌ 잘못된 방법
logger.info("주문 실행")  # 정보 부족
```

### 6. 예외 정보 포함

중요한 예외는 `exc_info=True`로 스택 트레이스를 포함:

```python
try:
    result = await complex_operation()
except Exception as e:
    logger.error(
        f"작업 실패: {operation_name}",
        exc_info=True  # 스택 트레이스 포함
    )
```

### 7. 민감한 정보 제외

비밀번호, API 키 등 민감한 정보는 로그에 포함하지 않습니다:

```python
# ✅ 올바른 방법
logger.info(f"API 요청 시작: endpoint={endpoint}")

# ❌ 잘못된 방법
logger.info(f"API 요청 시작: endpoint={endpoint}, api_key={api_key}")  # 보안 위험
```

## 로그 파일 관리

### 1. 파일 로깅

중요한 로그는 파일로 저장:

```python
import logging
from pathlib import Path

log_file = Path('logs/app.log')
log_file.parent.mkdir(parents=True, exist_ok=True)

logging.basicConfig(
    handlers=[
        logging.FileHandler(log_file),
        logging.StreamHandler()
    ]
)
```

### 2. 로그 로테이션

대용량 로그 파일 관리를 위해 로테이션 사용:

```python
from logging.handlers import RotatingFileHandler

handler = RotatingFileHandler(
    'app.log',
    maxBytes=10*1024*1024,  # 10MB
    backupCount=5
)
logger.addHandler(handler)
```

## 모듈별 로거

각 모듈은 자체 로거를 사용합니다:

```python
# app/services/stock_service.py
logger = logging.getLogger(__name__)  # 'app.services.stock_service'

# app/api/routes/stocks.py
logger = logging.getLogger(__name__)  # 'app.api.routes.stocks'
```

## 로그 레벨별 사용 가이드

### DEBUG
- 변수 값 출력
- 함수 진입/종료
- 상세한 실행 흐름

### INFO
- 작업 시작/완료
- 중요한 상태 변경
- 사용자 액션 로깅

### WARNING
- 비정상적인 상황 (계속 진행 가능)
- 설정 누락
- 성능 저하 가능성

### ERROR
- 작업 실패
- 예외 발생
- 복구 불가능한 오류

### CRITICAL
- 시스템 중단 위험
- 데이터 손실 위험
- 보안 위반

## 참고

- **로깅 오버헤드**: 프로덕션에서는 불필요한 DEBUG 로그는 비활성화
- **로그 분석**: 구조화된 로그 메시지로 분석 용이
- **보안**: 민감한 정보는 절대 로그에 포함하지 않음
